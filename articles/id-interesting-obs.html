<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Identify Interesting Observations • brolgar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Identify Interesting Observations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brolgar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/visualisation-gallery.html">Gallery</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/longitudinal-data-structures.html">Data Structures</a></li>
    <li><a class="dropdown-item" href="../articles/exploratory-modelling.html">Exploratory Modelling</a></li>
    <li><a class="dropdown-item" href="../articles/finding-features.html">Finding Features</a></li>
    <li><a class="dropdown-item" href="../articles/id-interesting-obs.html">Identify Interesting Observations</a></li>
    <li><a class="dropdown-item" href="../articles/mixed-effects-models.html">Exploring Mixed Effects Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/njtierney/brolgar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Identify Interesting Observations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/njtierney/brolgar/blob/main/vignettes/id-interesting-obs.Rmd" class="external-link"><code>vignettes/id-interesting-obs.Rmd</code></a></small>
      <div class="d-none name"><code>id-interesting-obs.Rmd</code></div>
    </div>

    
    
<p>This vignette unpacks how to find interesting individuals.</p>
<p>Let’s say we calculate a slope for each individual <code>key</code>,
using <code>keys_slope()</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wages_slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span><span class="op">(</span><span class="va">wages</span>, <span class="va">ln_wages</span> <span class="op">~</span> <span class="va">xp</span><span class="op">)</span> </span>
<span><span class="va">wages_slope</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 888 × 3</span></span></span>
<span><span class="co">#&gt;       id .intercept .slope_xp</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    31       1.41    0.101 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    36       2.04    0.058<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    53       2.29   -<span style="color: #BB0000;">0.358</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   122       1.93    0.037<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   134       2.03    0.083<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   145       1.59    0.046<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   155       1.66    0.086<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   173       1.61    0.100 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   206       1.73    0.180 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   207       1.62    0.088<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 878 more rows</span></span></span></code></pre></div>
<p>This is neat! But now we want to know those <code>keys</code> that
are <strong>nearest</strong> to some set of summary statistics of the
slope. By <strong>nearest</strong> here we mean which values have the
smallest numerical difference.</p>
<p>Let’s say the <em>five number summary</em>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wages_slope</span><span class="op">$</span><span class="va">.slope_xp</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's </span></span>
<span><span class="co">#&gt; -4.576923 -0.007637  0.047958  0.062350  0.094475 13.215686        38</span></span></code></pre></div>
<p>If want to find those individuals that have slopes
<strong>near</strong> these values.</p>
<p>We can do this using <code><a href="../reference/keys_near.html">keys_near()</a></code>, which returns those
nearest to some summary statistics. In this case, it is the five number
summary. In the next section we describe how you can provide your own
named list of functions to use.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wages_slope_near</span> <span class="op">&lt;-</span> <span class="va">wages_slope</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">id</span>,</span>
<span>            var <span class="op">=</span> <span class="va">.slope_xp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wages_slope_near</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;      id .slope_xp stat  stat_value stat_diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>305   0.048<span style="text-decoration: underline;">0</span>  med      0.048<span style="text-decoration: underline;">0</span>  0.000<span style="text-decoration: underline;">049</span>8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>594  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">68</span> q_25    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span> 0.000<span style="text-decoration: underline;">012</span>7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">7</span>918  -<span style="color: #BB0000;">4.58</span>    min     -<span style="color: #BB0000;">4.58</span>    0        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">10</span>380   0.047<span style="text-decoration: underline;">9</span>  med      0.048<span style="text-decoration: underline;">0</span>  0.000<span style="text-decoration: underline;">049</span>8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="text-decoration: underline;">12</span>178   0.094<span style="text-decoration: underline;">6</span>  q_75     0.094<span style="text-decoration: underline;">7</span>  0.000<span style="text-decoration: underline;">057</span>9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">12</span>455  13.2     max     13.2     0</span></span></code></pre></div>
<p>We can then join this information back against the data and plot
those interesting individuals:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wages_slope_near</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wages</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xp</span>,</span>
<span>             y <span class="op">=</span> <span class="va">ln_wages</span>,</span>
<span>             group <span class="op">=</span> <span class="va">id</span>,</span>
<span>             colour <span class="op">=</span> <span class="va">stat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/plot-keys-near-1.png" width="700"></p>
<p>You could also, with a bit of work, show these lines against the
background using gghighlight</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yutannihilation.github.io/gghighlight/" class="external-link">gghighlight</a></span><span class="op">)</span></span>
<span><span class="va">wages</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wages_slope_near</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xp</span>,</span>
<span>             y <span class="op">=</span> <span class="va">ln_wages</span>,</span>
<span>             group <span class="op">=</span> <span class="va">id</span>,</span>
<span>             colour <span class="op">=</span> <span class="va">stat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html" class="external-link">gghighlight</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/gghighlight-near-1.png" width="700"></p>
<div class="section level2">
<h2 id="specify-your-own-summaries-for-keys_near">Specify your own summaries for <code>keys_near</code><a class="anchor" aria-label="anchor" href="#specify-your-own-summaries-for-keys_near"></a>
</h2>
<p>You can specify your own list of summaries to pass to
<code>keys_near</code>. For example, you could create your own summaries
to give a sense of range. Note that the functions here start with
<code>b_</code>, and are <code>b_summaries</code> provided by
<code>brolgar</code> that have sensible defaults. You can <a href="https://brolgar.njtierney.com/reference/b_summaries.html" class="external-link">read
about them here</a>, or with <code><a href="../reference/b_summaries.html">?b_summaries</a></code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l_ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="va">b_min</span>,</span>
<span>                range_diff <span class="op">=</span> <span class="va">b_range_diff</span>,</span>
<span>                max <span class="op">=</span> <span class="va">b_max</span>,</span>
<span>                iqr <span class="op">=</span> <span class="va">b_iqr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wages</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">ln_wages</span> <span class="op">~</span> <span class="va">xp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">id</span>,</span>
<span>           var <span class="op">=</span> <span class="va">.slope_xp</span>,</span>
<span>           funs <span class="op">=</span> <span class="va">l_ranges</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;      id .slope_xp stat       stat_value stat_diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">7</span>918    -<span style="color: #BB0000;">4.58</span>  min            -<span style="color: #BB0000;">4.58</span>   0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">9</span>357     0.103 iqr             0.102  0.000<span style="text-decoration: underline;">139</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="text-decoration: underline;">12</span>455    13.2   range_diff     17.8    4.58    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">12</span>455    13.2   max            13.2    0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="implementation-of-keys_near">Implementation of <code>keys_near</code><a class="anchor" aria-label="anchor" href="#implementation-of-keys_near"></a>
</h2>
<p>If you are interested in the specifics of how
<code><a href="../reference/keys_near.html">keys_near()</a></code> works, this section describes how it is
implemented in <code>brolgar</code>.</p>
<p>To get the data into the right format, there are a few steps.</p>
<p>First, we need to get the data into a format where we have all the
statistics that we are interested in, along with the id, and the
statistic of interest.</p>
<p>We can fit a linear model for each <code>key</code> in the dataset
using <code><a href="../reference/key_slope.html">key_slope()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wages_slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span><span class="op">(</span><span class="va">wages</span>, <span class="va">ln_wages</span> <span class="op">~</span> <span class="va">xp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wages_slope</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 888 × 3</span></span></span>
<span><span class="co">#&gt;       id .intercept .slope_xp</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    31       1.41    0.101 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    36       2.04    0.058<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    53       2.29   -<span style="color: #BB0000;">0.358</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   122       1.93    0.037<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   134       2.03    0.083<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   145       1.59    0.046<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   155       1.66    0.086<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   173       1.61    0.100 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   206       1.73    0.180 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   207       1.62    0.088<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 878 more rows</span></span></span></code></pre></div>
<p>We can then perform a summary of the statistic of interest, in this
case the slope.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wages_slope_all_stats</span> <span class="op">&lt;-</span> <span class="va">wages_slope</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span>.vars <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">.slope_xp</span><span class="op">)</span>,</span>
<span>            .funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.slope_min <span class="op">=</span> <span class="va">b_min</span>,</span>
<span>                         .slope_max <span class="op">=</span> <span class="va">b_max</span>,</span>
<span>                         .slope_median <span class="op">=</span> <span class="va">b_median</span>,</span>
<span>                         .slope_q1 <span class="op">=</span> <span class="va">b_q25</span>,</span>
<span>                         .slope_q3 <span class="op">=</span> <span class="va">b_q75</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>,</span>
<span>         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">".slope"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wages_slope_all_stats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 888 × 7</span></span></span>
<span><span class="co">#&gt;       id .slope_xp .slope_min .slope_max .slope_median .slope_q1 .slope_q3</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    31    0.101       -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    36    0.058<span style="text-decoration: underline;">8</span>      -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    53   -<span style="color: #BB0000;">0.358</span>       -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   122    0.037<span style="text-decoration: underline;">4</span>      -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   134    0.083<span style="text-decoration: underline;">1</span>      -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   145    0.046<span style="text-decoration: underline;">9</span>      -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   155    0.086<span style="text-decoration: underline;">7</span>      -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   173    0.100       -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   206    0.180       -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   207    0.088<span style="text-decoration: underline;">4</span>      -<span style="color: #BB0000;">4.58</span>       13.2        0.048<span style="text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span>    0.094<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 878 more rows</span></span></span></code></pre></div>
<p>We then need to convert this into long format</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wages_slope_all_stats_long</span> <span class="op">&lt;-</span> </span>
<span><span class="va">wages_slope_all_stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"stat"</span>,</span>
<span>         value <span class="op">=</span> <span class="st">"stat_value"</span>,</span>
<span>         <span class="op">-</span><span class="va">id</span>,</span>
<span>         <span class="op">-</span><span class="va">.slope_xp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wages_slope_all_stats_long</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,440 × 4</span></span></span>
<span><span class="co">#&gt;       id .slope_xp stat       stat_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    31    0.101  .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    36    0.058<span style="text-decoration: underline;">8</span> .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    53   -<span style="color: #BB0000;">0.358</span>  .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   122    0.037<span style="text-decoration: underline;">4</span> .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   134    0.083<span style="text-decoration: underline;">1</span> .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   145    0.046<span style="text-decoration: underline;">9</span> .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   155    0.086<span style="text-decoration: underline;">7</span> .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   173    0.100  .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   206    0.180  .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   207    0.088<span style="text-decoration: underline;">4</span> .slope_min      -<span style="color: #BB0000;">4.58</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,430 more rows</span></span></span></code></pre></div>
<p>We can then calculate the difference between each stat and the slope,
<code>.slope_xp</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_diff</span> <span class="op">&lt;-</span> </span>
<span><span class="va">wages_slope_all_stats_long</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stat_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">.slope_xp</span> <span class="op">-</span> <span class="va">stat_value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stats_diff</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,440 × 5</span></span></span>
<span><span class="co">#&gt;       id .slope_xp stat       stat_value stat_diff</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    31    0.101  .slope_min      -<span style="color: #BB0000;">4.58</span>      4.68</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    36    0.058<span style="text-decoration: underline;">8</span> .slope_min      -<span style="color: #BB0000;">4.58</span>      4.64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    53   -<span style="color: #BB0000;">0.358</span>  .slope_min      -<span style="color: #BB0000;">4.58</span>      4.22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   122    0.037<span style="text-decoration: underline;">4</span> .slope_min      -<span style="color: #BB0000;">4.58</span>      4.61</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   134    0.083<span style="text-decoration: underline;">1</span> .slope_min      -<span style="color: #BB0000;">4.58</span>      4.66</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   145    0.046<span style="text-decoration: underline;">9</span> .slope_min      -<span style="color: #BB0000;">4.58</span>      4.62</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   155    0.086<span style="text-decoration: underline;">7</span> .slope_min      -<span style="color: #BB0000;">4.58</span>      4.66</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   173    0.100  .slope_min      -<span style="color: #BB0000;">4.58</span>      4.68</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   206    0.180  .slope_min      -<span style="color: #BB0000;">4.58</span>      4.76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   207    0.088<span style="text-decoration: underline;">4</span> .slope_min      -<span style="color: #BB0000;">4.58</span>      4.67</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,430 more rows</span></span></span></code></pre></div>
<p>With stats diff, we can then group by the <code>stat</code>, and find
return those rows with the smallest difference between the statistic and
the value:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top_stats_diff</span> <span class="op">&lt;-</span> </span>
<span><span class="va">stats_diff</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">stat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,</span>
<span>        wt <span class="op">=</span> <span class="va">stat_diff</span><span class="op">)</span></span>
<span></span>
<span><span class="va">top_stats_diff</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   stat [5]</span></span></span>
<span><span class="co">#&gt;      id .slope_xp stat          stat_value stat_diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">7</span>918  -<span style="color: #BB0000;">4.58</span>    .slope_min      -<span style="color: #BB0000;">4.58</span>    0        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">12</span>455  13.2     .slope_max      13.2     0        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>305   0.048<span style="text-decoration: underline;">0</span>  .slope_median    0.048<span style="text-decoration: underline;">0</span>  0.000<span style="text-decoration: underline;">049</span>8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">10</span>380   0.047<span style="text-decoration: underline;">9</span>  .slope_median    0.048<span style="text-decoration: underline;">0</span>  0.000<span style="text-decoration: underline;">049</span>8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>594  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">68</span> .slope_q1       -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">69</span> 0.000<span style="text-decoration: underline;">012</span>7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">12</span>178   0.094<span style="text-decoration: underline;">6</span>  .slope_q3        0.094<span style="text-decoration: underline;">7</span>  0.000<span style="text-decoration: underline;">057</span>9</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top_stats_diff</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wages</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xp</span>,</span>
<span>             y <span class="op">=</span> <span class="va">ln_wages</span>,</span>
<span>             group <span class="op">=</span> <span class="va">id</span>,</span>
<span>             colour <span class="op">=</span> <span class="va">stat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/join-top-stats-diff-1.png" width="700"></p>
<p>We can see that we get the same output using
<code><a href="../reference/keys_near.html">keys_near()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wages</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span><span class="op">(</span><span class="va">ln_wages</span> <span class="op">~</span> <span class="va">xp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">id</span>,</span>
<span>            var <span class="op">=</span> <span class="va">.slope_xp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wages</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xp</span>,</span>
<span>             y <span class="op">=</span> <span class="va">ln_wages</span>,</span>
<span>             group <span class="op">=</span> <span class="va">id</span>,</span>
<span>             colour <span class="op">=</span> <span class="va">stat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/show-same-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, Di Cook, Tania Prvan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
