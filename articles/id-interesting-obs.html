<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identify Interesting Observations • brolgar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Identify Interesting Observations">
<meta property="og:description" content="brolgar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brolgar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.5.9100</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li>
  <a href="../articles/visualisation-gallery.html">Gallery</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/longitudinal-data-structures.html">Data Structures</a>
    </li>
    <li>
      <a href="../articles/exploratory-modelling.html">Exploratory Modelling</a>
    </li>
    <li>
      <a href="../articles/finding-features.html">Finding Features</a>
    </li>
    <li>
      <a href="../articles/id-interesting-obs.html">Identify Interesting Observations</a>
    </li>
    <li>
      <a href="../articles/mixed-effects-models.html">Exploring Mixed Effects Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/njtierney/brolgar/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Identify Interesting Observations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/njtierney/brolgar/blob/master/vignettes/id-interesting-obs.Rmd"><code>vignettes/id-interesting-obs.Rmd</code></a></small>
      <div class="hidden name"><code>id-interesting-obs.Rmd</code></div>

    </div>

    
    
<p>This vignette unpacks how to find interesting individuals.</p>
<p>Let’s say we calculate a slope for each individual <code>key</code>, using <code>keys_slope()</code>:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">wages_slope</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span>(<span class="no">wages</span>, <span class="no">ln_wages</span> ~ <span class="no">xp</span>)
<span class="no">wages_slope</span>
<span class="co">#&gt; # A tibble: 888 x 3</span>
<span class="co">#&gt;       id .intercept .slope_xp</span>
<span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1    31       1.41    0.101 </span>
<span class="co">#&gt;  2    36       2.04    0.0588</span>
<span class="co">#&gt;  3    53       2.29   -0.358 </span>
<span class="co">#&gt;  4   122       1.93    0.0374</span>
<span class="co">#&gt;  5   134       2.03    0.0831</span>
<span class="co">#&gt;  6   145       1.59    0.0469</span>
<span class="co">#&gt;  7   155       1.66    0.0867</span>
<span class="co">#&gt;  8   173       1.61    0.100 </span>
<span class="co">#&gt;  9   206       1.73    0.180 </span>
<span class="co">#&gt; 10   207       1.62    0.0884</span>
<span class="co">#&gt; # … with 878 more rows</span></pre></body></html></div>
<p>This is neat! But now we want to know those <code>keys</code> that are <strong>nearest</strong> to some set of summary statistics of the slope. By <strong>nearest</strong> here we mean which values have the smallest numerical difference.</p>
<p>Let’s say the <em>five number summary</em>:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">wages_slope</span>$<span class="no">.slope_xp</span>)
<span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's </span>
<span class="co">#&gt; -4.57692 -0.00764  0.04796  0.06235  0.09447 13.21569       38</span></pre></body></html></div>
<p>If want to find those individuals that have slopes <strong>near</strong> these values.</p>
<p>We can do this using <code><a href="../reference/keys_near.html">keys_near()</a></code>, which returns those nearest to some summary statistics. In this case, it is the five number summary. In the next section we describe how you can provide your own named list of functions to use.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="no">wages_slope_near</span> <span class="kw">&lt;-</span> <span class="no">wages_slope</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">id</span>,
            <span class="kw">var</span> <span class="kw">=</span> <span class="no">.slope_xp</span>)
<span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span>
<span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span>
<span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span>
<span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span>

<span class="no">wages_slope_near</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;      id .slope_xp stat  stat_value stat_diff</span>
<span class="co">#&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  7918  -4.58    min     -4.58    0        </span>
<span class="co">#&gt; 2  2594  -0.00768 q_25    -0.00769 0.0000127</span>
<span class="co">#&gt; 3  2305   0.0480  med      0.0480  0.0000498</span>
<span class="co">#&gt; 4 10380   0.0479  med      0.0480  0.0000498</span>
<span class="co">#&gt; 5 12178   0.0946  q_75     0.0947  0.0000579</span>
<span class="co">#&gt; 6 12455  13.2     max     13.2     0</span></pre></body></html></div>
<p>We can then join this information back against the data and plot those interesting individuals:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="no">wages_slope_near</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">wages</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xp</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="no">ln_wages</span>,
             <span class="kw">group</span> <span class="kw">=</span> <span class="no">id</span>,
             <span class="kw">colour</span> <span class="kw">=</span> <span class="no">stat</span>)) +
  <span class="fu">geom_line</span>()</pre></body></html></div>
<p><img src="id-interesting-obs_files/figure-html/plot-keys-near-1.png" width="700"></p>
<p>You could also, with a bit of work, show these lines against the background using gghighlight</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gghighlight</span>)
<span class="no">wages</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">wages_slope_near</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>() <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xp</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="no">ln_wages</span>,
             <span class="kw">group</span> <span class="kw">=</span> <span class="no">id</span>,
             <span class="kw">colour</span> <span class="kw">=</span> <span class="no">stat</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">stat</span>))
<span class="co">#&gt; Warning: Tried to calculate with group_by(), but the calculation failed.</span>
<span class="co">#&gt; Falling back to ungrouped filter operation...</span>
<span class="co">#&gt; label_key: id</span></pre></body></html></div>
<p><img src="id-interesting-obs_files/figure-html/gghighlight-near-1.png" width="700"></p>
<div id="specify-your-own-summaries-for-keys_near" class="section level1">
<h1 class="hasAnchor">
<a href="#specify-your-own-summaries-for-keys_near" class="anchor"></a>Specify your own summaries for <code>keys_near</code>
</h1>
<p>You can specify your own list of summaries to pass to <code>keys_near</code>. For example, you could create your own summaries to give a sense of range. Note that the functions here start with <code>b_</code>, and are <code>b_summaries</code> provided by <code>brolgar</code> that have sensible defaults. You can <a href="http://brolgar.njtierney.com/reference/b_summaries.html">read about them here</a>, or with <code><a href="../reference/b_summaries.html">?b_summaries</a></code></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">l_ranges</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">min</span> <span class="kw">=</span> <span class="no">b_min</span>,
                <span class="kw">range_diff</span> <span class="kw">=</span> <span class="no">b_range_diff</span>,
                <span class="kw">max</span> <span class="kw">=</span> <span class="no">b_max</span>,
                <span class="kw">iqr</span> <span class="kw">=</span> <span class="no">b_iqr</span>)

<span class="no">wages</span> <span class="kw">%&gt;%</span>
 <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">ln_wages</span> ~ <span class="no">xp</span>) <span class="kw">%&gt;%</span>
 <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">id</span>,
           <span class="kw">var</span> <span class="kw">=</span> <span class="no">.slope_xp</span>,
           <span class="kw">funs</span> <span class="kw">=</span> <span class="no">l_ranges</span>)
<span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span>
<span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span>
<span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span>
<span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;      id .slope_xp stat       stat_value stat_diff</span>
<span class="co">#&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;           &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  7918    -4.58  min            -4.58   0       </span>
<span class="co">#&gt; 2 12455    13.2   range_diff     17.8    4.58    </span>
<span class="co">#&gt; 3 12455    13.2   max            13.2    0       </span>
<span class="co">#&gt; 4  9357     0.103 iqr             0.102  0.000139</span></pre></body></html></div>
</div>
<div id="implementation-of-keys_near" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation-of-keys_near" class="anchor"></a>Implementation of <code>keys_near</code>
</h1>
<p>If you are interested in the specifics of how <code><a href="../reference/keys_near.html">keys_near()</a></code> works, this section describes how it is implemented in <code>brolgar</code>.</p>
<p>To get the data into the right format, there are a few steps.</p>
<p>First, we need to get the data into a format where we have all the statistics that we are interested in, along with the id, and the statistic of interest.</p>
<p>We can fit a linear model for each <code>key</code> in the dataset using <code><a href="../reference/key_slope.html">key_slope()</a></code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">wages_slope</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span>(<span class="no">wages</span>, <span class="no">ln_wages</span> ~ <span class="no">xp</span>)

<span class="no">wages_slope</span>
<span class="co">#&gt; # A tibble: 888 x 3</span>
<span class="co">#&gt;       id .intercept .slope_xp</span>
<span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1    31       1.41    0.101 </span>
<span class="co">#&gt;  2    36       2.04    0.0588</span>
<span class="co">#&gt;  3    53       2.29   -0.358 </span>
<span class="co">#&gt;  4   122       1.93    0.0374</span>
<span class="co">#&gt;  5   134       2.03    0.0831</span>
<span class="co">#&gt;  6   145       1.59    0.0469</span>
<span class="co">#&gt;  7   155       1.66    0.0867</span>
<span class="co">#&gt;  8   173       1.61    0.100 </span>
<span class="co">#&gt;  9   206       1.73    0.180 </span>
<span class="co">#&gt; 10   207       1.62    0.0884</span>
<span class="co">#&gt; # … with 878 more rows</span></pre></body></html></div>
<p>We can then perform a summary of the statistic of interest, in this case the slope.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">wages_slope_all_stats</span> <span class="kw">&lt;-</span> <span class="no">wages_slope</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate_at</span>(<span class="kw">.vars</span> <span class="kw">=</span> <span class="fu">vars</span>(<span class="no">.slope_xp</span>),
            <span class="kw">.funs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">.slope_min</span> <span class="kw">=</span> <span class="no">b_min</span>,
                         <span class="kw">.slope_max</span> <span class="kw">=</span> <span class="no">b_max</span>,
                         <span class="kw">.slope_median</span> <span class="kw">=</span> <span class="no">b_median</span>,
                         <span class="kw">.slope_q1</span> <span class="kw">=</span> <span class="no">b_q25</span>,
                         <span class="kw">.slope_q3</span> <span class="kw">=</span> <span class="no">b_q75</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">id</span>,
         <span class="fu">starts_with</span>(<span class="st">".slope"</span>))

<span class="no">wages_slope_all_stats</span>
<span class="co">#&gt; # A tibble: 888 x 7</span>
<span class="co">#&gt;       id .slope_xp .slope_min .slope_max .slope_median .slope_q1 .slope_q3</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1    31    0.101       -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  2    36    0.0588      -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  3    53   -0.358       -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  4   122    0.0374      -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  5   134    0.0831      -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  6   145    0.0469      -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  7   155    0.0867      -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  8   173    0.100       -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt;  9   206    0.180       -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt; 10   207    0.0884      -4.58       13.2        0.0480  -0.00769    0.0947</span>
<span class="co">#&gt; # … with 878 more rows</span></pre></body></html></div>
<p>We then need to convert this into long format</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">wages_slope_all_stats_long</span> <span class="kw">&lt;-</span>
<span class="no">wages_slope_all_stats</span> <span class="kw">%&gt;%</span>
<span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="st">"stat"</span>,
         <span class="kw">value</span> <span class="kw">=</span> <span class="st">"stat_value"</span>,
         -<span class="no">id</span>,
         -<span class="no">.slope_xp</span>)

<span class="no">wages_slope_all_stats_long</span>
<span class="co">#&gt; # A tibble: 4,440 x 4</span>
<span class="co">#&gt;       id .slope_xp stat       stat_value</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1    31    0.101  .slope_min      -4.58</span>
<span class="co">#&gt;  2    36    0.0588 .slope_min      -4.58</span>
<span class="co">#&gt;  3    53   -0.358  .slope_min      -4.58</span>
<span class="co">#&gt;  4   122    0.0374 .slope_min      -4.58</span>
<span class="co">#&gt;  5   134    0.0831 .slope_min      -4.58</span>
<span class="co">#&gt;  6   145    0.0469 .slope_min      -4.58</span>
<span class="co">#&gt;  7   155    0.0867 .slope_min      -4.58</span>
<span class="co">#&gt;  8   173    0.100  .slope_min      -4.58</span>
<span class="co">#&gt;  9   206    0.180  .slope_min      -4.58</span>
<span class="co">#&gt; 10   207    0.0884 .slope_min      -4.58</span>
<span class="co">#&gt; # … with 4,430 more rows</span></pre></body></html></div>
<p>We can then calculate the difference between each stat and the slope, <code>.slope_xp</code>:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">stats_diff</span> <span class="kw">&lt;-</span>
<span class="no">wages_slope_all_stats_long</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">stat_diff</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">.slope_xp</span> - <span class="no">stat_value</span>))

<span class="no">stats_diff</span>
<span class="co">#&gt; # A tibble: 4,440 x 5</span>
<span class="co">#&gt;       id .slope_xp stat       stat_value stat_diff</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1    31    0.101  .slope_min      -4.58      4.68</span>
<span class="co">#&gt;  2    36    0.0588 .slope_min      -4.58      4.64</span>
<span class="co">#&gt;  3    53   -0.358  .slope_min      -4.58      4.22</span>
<span class="co">#&gt;  4   122    0.0374 .slope_min      -4.58      4.61</span>
<span class="co">#&gt;  5   134    0.0831 .slope_min      -4.58      4.66</span>
<span class="co">#&gt;  6   145    0.0469 .slope_min      -4.58      4.62</span>
<span class="co">#&gt;  7   155    0.0867 .slope_min      -4.58      4.66</span>
<span class="co">#&gt;  8   173    0.100  .slope_min      -4.58      4.68</span>
<span class="co">#&gt;  9   206    0.180  .slope_min      -4.58      4.76</span>
<span class="co">#&gt; 10   207    0.0884 .slope_min      -4.58      4.67</span>
<span class="co">#&gt; # … with 4,430 more rows</span></pre></body></html></div>
<p>With stats diff, we can then group by the <code>stat</code>, and find return those rows with the smallest difference between the statistic and the value:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">top_stats_diff</span> <span class="kw">&lt;-</span>
<span class="no">stats_diff</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">stat</span>) <span class="kw">%&gt;%</span>
  <span class="fu">top_n</span>(-<span class="fl">1</span>,
        <span class="kw">wt</span> <span class="kw">=</span> <span class="no">stat_diff</span>)

<span class="no">top_stats_diff</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt; # Groups:   stat [5]</span>
<span class="co">#&gt;      id .slope_xp stat          stat_value stat_diff</span>
<span class="co">#&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  7918  -4.58    .slope_min      -4.58    0        </span>
<span class="co">#&gt; 2 12455  13.2     .slope_max      13.2     0        </span>
<span class="co">#&gt; 3  2305   0.0480  .slope_median    0.0480  0.0000498</span>
<span class="co">#&gt; 4 10380   0.0479  .slope_median    0.0480  0.0000498</span>
<span class="co">#&gt; 5  2594  -0.00768 .slope_q1       -0.00769 0.0000127</span>
<span class="co">#&gt; 6 12178   0.0946  .slope_q3        0.0947  0.0000579</span></pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">top_stats_diff</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">wages</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xp</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="no">ln_wages</span>,
             <span class="kw">group</span> <span class="kw">=</span> <span class="no">id</span>,
             <span class="kw">colour</span> <span class="kw">=</span> <span class="no">stat</span>)) +
  <span class="fu">geom_line</span>()</pre></body></html></div>
<p><img src="id-interesting-obs_files/figure-html/join-top-stats-diff-1.png" width="700"></p>
<p>We can see that we get the same output using <code><a href="../reference/keys_near.html">keys_near()</a></code>:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">wages</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span>(<span class="no">ln_wages</span> ~ <span class="no">xp</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">id</span>,
            <span class="kw">var</span> <span class="kw">=</span> <span class="no">.slope_xp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">wages</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xp</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="no">ln_wages</span>,
             <span class="kw">group</span> <span class="kw">=</span> <span class="no">id</span>,
             <span class="kw">colour</span> <span class="kw">=</span> <span class="no">stat</span>)) +
  <span class="fu">geom_line</span>()
<span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span>
<span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span>
<span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span>
<span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span></pre></body></html></div>
<p><img src="id-interesting-obs_files/figure-html/show-same-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney, Di Cook, Tania Prvan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '48bc42eefc5234a6463c3b99e53dfda1',
    indexName: 'brolgar',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
