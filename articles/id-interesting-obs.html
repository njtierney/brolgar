<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identify Interesting Observations • brolgar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Identify Interesting Observations">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brolgar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.5.9100</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li>
  <a href="../articles/visualisation-gallery.html">Gallery</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/longitudinal-data-structures.html">Data Structures</a>
    </li>
    <li>
      <a href="../articles/exploratory-modelling.html">Exploratory Modelling</a>
    </li>
    <li>
      <a href="../articles/finding-features.html">Finding Features</a>
    </li>
    <li>
      <a href="../articles/id-interesting-obs.html">Identify Interesting Observations</a>
    </li>
    <li>
      <a href="../articles/mixed-effects-models.html">Exploring Mixed Effects Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/njtierney/brolgar">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="id-interesting-obs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Identify Interesting Observations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/njtierney/brolgar/blob/master/vignettes/id-interesting-obs.Rmd"><code>vignettes/id-interesting-obs.Rmd</code></a></small>
      <div class="hidden name"><code>id-interesting-obs.Rmd</code></div>

    </div>

    
    
<p>This vignette unpacks how to find interesting individuals.</p>
<p>Let’s say we calculate a slope for each individual <code>key</code>, using <code>keys_slope()</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>wages_slope &lt;-<span class="st"> </span><span class="kw"><a href="../reference/key_slope.html">key_slope</a></span>(wages, ln_wages <span class="op">~</span><span class="st"> </span>xp) </span>
<span id="cb1-2"><a href="#cb1-2"></a>wages_slope</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; # A tibble: 888 x 3</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt;       id .intercept .slope_xp</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt;  1    31       1.41    0.101 </span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt;  2    36       2.04    0.0588</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt;  3    53       2.29   -0.358 </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt;  4   122       1.93    0.0374</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt;  5   134       2.03    0.0831</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt;  6   145       1.59    0.0469</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt;  7   155       1.66    0.0867</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt;  8   173       1.61    0.100 </span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt;  9   206       1.73    0.180 </span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt; 10   207       1.62    0.0884</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">#&gt; # … with 878 more rows</span></span></code></pre></div>
<p>This is neat! But now we want to know those <code>keys</code> that are <strong>nearest</strong> to some set of summary statistics of the slope. By <strong>nearest</strong> here we mean which values have the smallest numerical difference.</p>
<p>Let’s say the <em>five number summary</em>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(wages_slope<span class="op">$</span>.slope_xp)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's </span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; -4.57692 -0.00764  0.04796  0.06235  0.09447 13.21569       38</span></span></code></pre></div>
<p>If want to find those individuals that have slopes <strong>near</strong> these values.</p>
<p>We can do this using <code><a href="../reference/keys_near.html">keys_near()</a></code>, which returns those nearest to some summary statistics. In this case, it is the five number summary. In the next section we describe how you can provide your own named list of functions to use.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a></span>
<span id="cb3-2"><a href="#cb3-2"></a>wages_slope_near &lt;-<span class="st"> </span>wages_slope <span class="op">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span><span class="kw"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="dt">key =</span> id,</span>
<span id="cb3-4"><a href="#cb3-4"></a>            <span class="dt">var =</span> .slope_xp)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a>wages_slope_near</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; # A tibble: 6 x 5</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt;      id .slope_xp stat  stat_value stat_diff</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; 1  7918  -4.58    min     -4.58    0        </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; 2  2594  -0.00768 q_25    -0.00769 0.0000127</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; 3  2305   0.0480  med      0.0480  0.0000498</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; 4 10380   0.0479  med      0.0480  0.0000498</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; 5 12178   0.0946  q_75     0.0947  0.0000579</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; 6 12455  13.2     max     13.2     0</span></span></code></pre></div>
<p>We can then join this information back against the data and plot those interesting individuals:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a></span>
<span id="cb4-2"><a href="#cb4-2"></a>wages_slope_near <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span><span class="kw">left_join</span>(wages, <span class="dt">by =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> xp,</span>
<span id="cb4-5"><a href="#cb4-5"></a>             <span class="dt">y =</span> ln_wages,</span>
<span id="cb4-6"><a href="#cb4-6"></a>             <span class="dt">group =</span> id,</span>
<span id="cb4-7"><a href="#cb4-7"></a>             <span class="dt">colour =</span> stat)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/plot-keys-near-1.png" width="700"></p>
<p>You could also, with a bit of work, show these lines against the background using gghighlight</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(gghighlight)</span>
<span id="cb5-2"><a href="#cb5-2"></a>wages <span class="op">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">left_join</span>(wages_slope_near, <span class="dt">by =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="dt">x =</span> xp,</span>
<span id="cb5-6"><a href="#cb5-6"></a>             <span class="dt">y =</span> ln_wages,</span>
<span id="cb5-7"><a href="#cb5-7"></a>             <span class="dt">group =</span> id,</span>
<span id="cb5-8"><a href="#cb5-8"></a>             <span class="dt">colour =</span> stat)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(stat))</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; Warning: Tried to calculate with group_by(), but the calculation failed.</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; Falling back to ungrouped filter operation...</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; label_key: id</span></span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/gghighlight-near-1.png" width="700"></p>
<div id="specify-your-own-summaries-for-keys_near" class="section level1">
<h1 class="hasAnchor">
<a href="#specify-your-own-summaries-for-keys_near" class="anchor"></a>Specify your own summaries for <code>keys_near</code>
</h1>
<p>You can specify your own list of summaries to pass to <code>keys_near</code>. For example, you could create your own summaries to give a sense of range. Note that the functions here start with <code>b_</code>, and are <code>b_summaries</code> provided by <code>brolgar</code> that have sensible defaults. You can <a href="http://brolgar.njtierney.com/reference/b_summaries.html">read about them here</a>, or with <code><a href="../reference/b_summaries.html">?b_summaries</a></code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>l_ranges &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min =</span> b_min,</span>
<span id="cb6-2"><a href="#cb6-2"></a>                <span class="dt">range_diff =</span> b_range_diff,</span>
<span id="cb6-3"><a href="#cb6-3"></a>                <span class="dt">max =</span> b_max,</span>
<span id="cb6-4"><a href="#cb6-4"></a>                <span class="dt">iqr =</span> b_iqr)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>wages <span class="op">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="st"> </span><span class="kw"><a href="../reference/key_slope.html">key_slope</a></span>(<span class="dt">formula =</span> ln_wages <span class="op">~</span><span class="st"> </span>xp) <span class="op">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="st"> </span><span class="kw"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="dt">key =</span> id,</span>
<span id="cb6-9"><a href="#cb6-9"></a>           <span class="dt">var =</span> .slope_xp,</span>
<span id="cb6-10"><a href="#cb6-10"></a>           <span class="dt">funs =</span> l_ranges)</span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; # A tibble: 4 x 5</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt;      id .slope_xp stat       stat_value stat_diff</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;           &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt; 1  7918    -4.58  min            -4.58   0       </span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt; 2 12455    13.2   range_diff     17.8    4.58    </span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt; 3 12455    13.2   max            13.2    0       </span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt; 4  9357     0.103 iqr             0.102  0.000139</span></span></code></pre></div>
</div>
<div id="implementation-of-keys_near" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation-of-keys_near" class="anchor"></a>Implementation of <code>keys_near</code>
</h1>
<p>If you are interested in the specifics of how <code><a href="../reference/keys_near.html">keys_near()</a></code> works, this section describes how it is implemented in <code>brolgar</code>.</p>
<p>To get the data into the right format, there are a few steps.</p>
<p>First, we need to get the data into a format where we have all the statistics that we are interested in, along with the id, and the statistic of interest.</p>
<p>We can fit a linear model for each <code>key</code> in the dataset using <code><a href="../reference/key_slope.html">key_slope()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>wages_slope &lt;-<span class="st"> </span><span class="kw"><a href="../reference/key_slope.html">key_slope</a></span>(wages, ln_wages <span class="op">~</span><span class="st"> </span>xp)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>wages_slope</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; # A tibble: 888 x 3</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt;       id .intercept .slope_xp</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt;  1    31       1.41    0.101 </span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt;  2    36       2.04    0.0588</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt;  3    53       2.29   -0.358 </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt;  4   122       1.93    0.0374</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt;  5   134       2.03    0.0831</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt;  6   145       1.59    0.0469</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt;  7   155       1.66    0.0867</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt;  8   173       1.61    0.100 </span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt;  9   206       1.73    0.180 </span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt; 10   207       1.62    0.0884</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt; # … with 878 more rows</span></span></code></pre></div>
<p>We can then perform a summary of the statistic of interest, in this case the slope.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>wages_slope_all_stats &lt;-<span class="st"> </span>wages_slope <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="dt">.vars =</span> <span class="kw">vars</span>(.slope_xp),</span>
<span id="cb8-3"><a href="#cb8-3"></a>            <span class="dt">.funs =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">.slope_min =</span> b_min,</span>
<span id="cb8-4"><a href="#cb8-4"></a>                         <span class="dt">.slope_max =</span> b_max,</span>
<span id="cb8-5"><a href="#cb8-5"></a>                         <span class="dt">.slope_median =</span> b_median,</span>
<span id="cb8-6"><a href="#cb8-6"></a>                         <span class="dt">.slope_q1 =</span> b_q25,</span>
<span id="cb8-7"><a href="#cb8-7"></a>                         <span class="dt">.slope_q3 =</span> b_q75)) <span class="op">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="st">  </span><span class="kw">select</span>(id,</span>
<span id="cb8-9"><a href="#cb8-9"></a>         <span class="kw">starts_with</span>(<span class="st">".slope"</span>))</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a>wages_slope_all_stats</span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; # A tibble: 888 x 7</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;       id .slope_xp .slope_min .slope_max .slope_median .slope_q1 .slope_q3</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;  1    31    0.101       -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt;  2    36    0.0588      -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt;  3    53   -0.358       -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt;  4   122    0.0374      -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt;  5   134    0.0831      -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="co">#&gt;  6   145    0.0469      -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="co">#&gt;  7   155    0.0867      -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co">#&gt;  8   173    0.100       -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co">#&gt;  9   206    0.180       -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="co">#&gt; 10   207    0.0884      -4.58       13.2        0.0480  -0.00769    0.0947</span></span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="co">#&gt; # … with 878 more rows</span></span></code></pre></div>
<p>We then need to convert this into long format</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>wages_slope_all_stats_long &lt;-<span class="st"> </span></span>
<span id="cb9-2"><a href="#cb9-2"></a>wages_slope_all_stats <span class="op">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">"stat"</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>         <span class="dt">value =</span> <span class="st">"stat_value"</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>         <span class="op">-</span>id,</span>
<span id="cb9-6"><a href="#cb9-6"></a>         <span class="op">-</span>.slope_xp)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>wages_slope_all_stats_long</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; # A tibble: 4,440 x 4</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt;       id .slope_xp stat       stat_value</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt;  1    31    0.101  .slope_min      -4.58</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt;  2    36    0.0588 .slope_min      -4.58</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt;  3    53   -0.358  .slope_min      -4.58</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt;  4   122    0.0374 .slope_min      -4.58</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt;  5   134    0.0831 .slope_min      -4.58</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">#&gt;  6   145    0.0469 .slope_min      -4.58</span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">#&gt;  7   155    0.0867 .slope_min      -4.58</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#&gt;  8   173    0.100  .slope_min      -4.58</span></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#&gt;  9   206    0.180  .slope_min      -4.58</span></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">#&gt; 10   207    0.0884 .slope_min      -4.58</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt; # … with 4,430 more rows</span></span></code></pre></div>
<p>We can then calculate the difference between each stat and the slope, <code>.slope_xp</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>stats_diff &lt;-<span class="st"> </span></span>
<span id="cb10-2"><a href="#cb10-2"></a>wages_slope_all_stats_long <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">stat_diff =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(.slope_xp <span class="op">-</span><span class="st"> </span>stat_value))</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a>stats_diff</span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt; # A tibble: 4,440 x 5</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt;       id .slope_xp stat       stat_value stat_diff</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt;  1    31    0.101  .slope_min      -4.58      4.68</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt;  2    36    0.0588 .slope_min      -4.58      4.64</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt;  3    53   -0.358  .slope_min      -4.58      4.22</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;  4   122    0.0374 .slope_min      -4.58      4.61</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt;  5   134    0.0831 .slope_min      -4.58      4.66</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt;  6   145    0.0469 .slope_min      -4.58      4.62</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt;  7   155    0.0867 .slope_min      -4.58      4.66</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt;  8   173    0.100  .slope_min      -4.58      4.68</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt;  9   206    0.180  .slope_min      -4.58      4.76</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt; 10   207    0.0884 .slope_min      -4.58      4.67</span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co">#&gt; # … with 4,430 more rows</span></span></code></pre></div>
<p>With stats diff, we can then group by the <code>stat</code>, and find return those rows with the smallest difference between the statistic and the value:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>top_stats_diff &lt;-<span class="st"> </span></span>
<span id="cb11-2"><a href="#cb11-2"></a>stats_diff <span class="op">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw">group_by</span>(stat) <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>        <span class="dt">wt =</span> stat_diff)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a>top_stats_diff</span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt; # A tibble: 6 x 5</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; # Groups:   stat [5]</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt;      id .slope_xp stat          stat_value stat_diff</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; 1  7918  -4.58    .slope_min      -4.58    0        </span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; 2 12455  13.2     .slope_max      13.2     0        </span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; 3  2305   0.0480  .slope_median    0.0480  0.0000498</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt; 4 10380   0.0479  .slope_median    0.0480  0.0000498</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">#&gt; 5  2594  -0.00768 .slope_q1       -0.00769 0.0000127</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#&gt; 6 12178   0.0946  .slope_q3        0.0947  0.0000579</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>top_stats_diff <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="st">  </span><span class="kw">left_join</span>(wages, <span class="dt">by =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="dt">x =</span> xp,</span>
<span id="cb12-4"><a href="#cb12-4"></a>             <span class="dt">y =</span> ln_wages,</span>
<span id="cb12-5"><a href="#cb12-5"></a>             <span class="dt">group =</span> id,</span>
<span id="cb12-6"><a href="#cb12-6"></a>             <span class="dt">colour =</span> stat)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/join-top-stats-diff-1.png" width="700"></p>
<p>We can see that we get the same output using <code><a href="../reference/keys_near.html">keys_near()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>wages <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw"><a href="../reference/key_slope.html">key_slope</a></span>(ln_wages <span class="op">~</span><span class="st"> </span>xp) <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="dt">key =</span> id,</span>
<span id="cb13-4"><a href="#cb13-4"></a>            <span class="dt">var =</span> .slope_xp) <span class="op">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="st">  </span><span class="kw">left_join</span>(wages, <span class="dt">by =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="dt">x =</span> xp,</span>
<span id="cb13-7"><a href="#cb13-7"></a>             <span class="dt">y =</span> ln_wages,</span>
<span id="cb13-8"><a href="#cb13-8"></a>             <span class="dt">group =</span> id,</span>
<span id="cb13-9"><a href="#cb13-9"></a>             <span class="dt">colour =</span> stat)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="st">  </span><span class="kw">geom_line</span>()</span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span></span></code></pre></div>
<p><img src="id-interesting-obs_files/figure-html/show-same-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#specify-your-own-summaries-for-keys_near">Specify your own summaries for <code>keys_near</code></a></li>
      <li><a href="#implementation-of-keys_near">Implementation of <code>keys_near</code></a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney, Di Cook, Tania Prvan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '48bc42eefc5234a6463c3b99e53dfda1',
    indexName: 'brolgar',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
