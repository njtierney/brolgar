<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploratory Modelling • brolgar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Exploratory Modelling">
<meta property="og:description" content="brolgar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brolgar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.5.9100</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li>
  <a href="../articles/visualisation-gallery.html">Gallery</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/longitudinal-data-structures.html">Data Structures</a>
    </li>
    <li>
      <a href="../articles/exploratory-modelling.html">Exploratory Modelling</a>
    </li>
    <li>
      <a href="../articles/finding-features.html">Finding Features</a>
    </li>
    <li>
      <a href="../articles/id-interesting-obs.html">Identify Interesting Observations</a>
    </li>
    <li>
      <a href="../articles/mixed-effects-models.html">Exploring Mixed Effects Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/njtierney/brolgar/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploratory Modelling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/njtierney/brolgar/blob/master/vignettes/exploratory-modelling.Rmd"><code>vignettes/exploratory-modelling.Rmd</code></a></small>
      <div class="hidden name"><code>exploratory-modelling.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">brolgar</span>)</pre></body></html></div>
<p>It can be useful to fit a model to explore your data. One technique is to fit a linear model for each group in a dataset. For example, you could fit a linear model for each key in the data.</p>
<p><code>brolgar</code> provides a helper function to help with this, called <code><a href="../reference/key_slope.html">key_slope()</a></code>.</p>
<p><code><a href="../reference/key_slope.html">key_slope()</a></code> returns the intercept and slope estimate for each key, given a linear model formula. We can get the number of observations, and slope information for each individual to identify those that are decreasing over time.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/key_slope.html">key_slope</a></span>(<span class="no">wages</span>,<span class="no">ln_wages</span> ~ <span class="no">xp</span>)
<span class="co">#&gt; # A tibble: 888 x 3</span>
<span class="co">#&gt;       id .intercept .slope_xp</span>
<span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1    31       1.41    0.101 </span>
<span class="co">#&gt;  2    36       2.04    0.0588</span>
<span class="co">#&gt;  3    53       2.29   -0.358 </span>
<span class="co">#&gt;  4   122       1.93    0.0374</span>
<span class="co">#&gt;  5   134       2.03    0.0831</span>
<span class="co">#&gt;  6   145       1.59    0.0469</span>
<span class="co">#&gt;  7   155       1.66    0.0867</span>
<span class="co">#&gt;  8   173       1.61    0.100 </span>
<span class="co">#&gt;  9   206       1.73    0.180 </span>
<span class="co">#&gt; 10   207       1.62    0.0884</span>
<span class="co">#&gt; # … with 878 more rows</span></pre></body></html></div>
<p>We can then join these summaries back to the data:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="no">wages_slope</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span>(<span class="no">wages</span>,<span class="no">ln_wages</span> ~ <span class="no">xp</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">wages</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>)

<span class="no">wages_slope</span>
<span class="co">#&gt; # A tibble: 6,402 x 11</span>
<span class="co">#&gt;       id .intercept .slope_xp ln_wages    xp   ged xp_since_ged black hispanic</span>
<span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt; &lt;int&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1    31       1.41    0.101      1.49 0.015     1        0.015     0        1</span>
<span class="co">#&gt;  2    31       1.41    0.101      1.43 0.715     1        0.715     0        1</span>
<span class="co">#&gt;  3    31       1.41    0.101      1.47 1.73      1        1.73      0        1</span>
<span class="co">#&gt;  4    31       1.41    0.101      1.75 2.77      1        2.77      0        1</span>
<span class="co">#&gt;  5    31       1.41    0.101      1.93 3.93      1        3.93      0        1</span>
<span class="co">#&gt;  6    31       1.41    0.101      1.71 4.95      1        4.95      0        1</span>
<span class="co">#&gt;  7    31       1.41    0.101      2.09 5.96      1        5.96      0        1</span>
<span class="co">#&gt;  8    31       1.41    0.101      2.13 6.98      1        6.98      0        1</span>
<span class="co">#&gt;  9    36       2.04    0.0588     1.98 0.315     1        0.315     0        0</span>
<span class="co">#&gt; 10    36       2.04    0.0588     1.80 0.983     1        0.983     0        0</span>
<span class="co">#&gt; # … with 6,392 more rows, and 2 more variables: high_grade &lt;int&gt;,</span>
<span class="co">#&gt; #   unemploy_rate &lt;dbl&gt;</span></pre></body></html></div>
<p>And highlight those individuals with a negative slope using <code>gghighlight</code>:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gghighlight</span>)
<span class="co">#&gt; Loading required package: ggplot2</span>

<span class="no">wages_slope</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>() <span class="kw">%&gt;%</span> <span class="co"># workaround for gghighlight + tsibble</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xp</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="no">ln_wages</span>,
             <span class="kw">group</span> <span class="kw">=</span> <span class="no">id</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span>(<span class="no">.slope_xp</span> <span class="kw">&lt;</span> <span class="fl">0</span>)
<span class="co">#&gt; Warning: Tried to calculate with group_by(), but the calculation failed.</span>
<span class="co">#&gt; Falling back to ungrouped filter operation...</span>
<span class="co">#&gt; label_key: id</span>
<span class="co">#&gt; Too many data series, skip labeling</span></pre></body></html></div>
<p><img src="exploratory-modelling_files/figure-html/use-gg-highlight-1.png" width="700"></p>
<div id="find-keys-near-other-summaries-with-keys_near" class="section level1">
<h1 class="hasAnchor">
<a href="#find-keys-near-other-summaries-with-keys_near" class="anchor"></a>Find keys near other summaries with <code>keys_near()</code>
</h1>
<p>We might want to further summarise our exploratory modelling by finding those slopes that are near a five number summary values:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">wages_slope</span>$<span class="no">.slope_xp</span>)
<span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's </span>
<span class="co">#&gt; -4.57692 -0.00189  0.04519  0.04490  0.08458 13.21569       38</span></pre></body></html></div>
<p>Finding those groups that are near these values can be surprisingly challenging!</p>
<p><code>brolgar</code> makes it easier by providing the <code><a href="../reference/keys_near.html">keys_near()</a></code> function. You tell it what the key is, what variable you want to summarise by, and then by default it returns those keys near the five number summary. Let’s return the keys near the <code>.slope_xp</code>:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">wages_slope</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">id</span>,
            <span class="kw">var</span> <span class="kw">=</span> <span class="no">.slope_xp</span>)
<span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span>
<span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span>
<span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span>
<span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span>
<span class="co">#&gt; # A tibble: 31 x 5</span>
<span class="co">#&gt;       id .slope_xp stat  stat_value stat_diff</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1  7918  -4.58    min     -4.58            0</span>
<span class="co">#&gt;  2  7918  -4.58    min     -4.58            0</span>
<span class="co">#&gt;  3  7918  -4.58    min     -4.58            0</span>
<span class="co">#&gt;  4  2092  -0.00189 q_25    -0.00189         0</span>
<span class="co">#&gt;  5  2092  -0.00189 q_25    -0.00189         0</span>
<span class="co">#&gt;  6  2092  -0.00189 q_25    -0.00189         0</span>
<span class="co">#&gt;  7  2092  -0.00189 q_25    -0.00189         0</span>
<span class="co">#&gt;  8  2092  -0.00189 q_25    -0.00189         0</span>
<span class="co">#&gt;  9  2092  -0.00189 q_25    -0.00189         0</span>
<span class="co">#&gt; 10  6863   0.0452  med      0.0452          0</span>
<span class="co">#&gt; # … with 21 more rows</span></pre></body></html></div>
<p>Here it returns the <code>id</code>, the <code>.slope_xp</code>, and the statistic that it was closest to, and what the difference between the slope_xp and the statistic.</p>
<p>You can visualise these summary keys by joining them back to the data:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">wages_slope</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">id</span>,
            <span class="kw">var</span> <span class="kw">=</span> <span class="no">.slope_xp</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">wages</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/reexports.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xp</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="no">ln_wages</span>,
             <span class="kw">group</span> <span class="kw">=</span> <span class="no">id</span>,
             <span class="kw">colour</span> <span class="kw">=</span> <span class="no">stat</span>)) +
  <span class="fu">geom_line</span>()
<span class="co">#&gt; Warning: Problem with `mutate()` input `stat`.</span>
<span class="co">#&gt; ℹ Outer names are only allowed for unnamed scalar atomic inputs</span>
<span class="co">#&gt; ℹ Input `stat` is `forcats::fct_relevel(.f = stat, levels = names(funs))`.</span>
<span class="co">#&gt; Warning: Outer names are only allowed for unnamed scalar atomic inputs</span></pre></body></html></div>
<p><img src="exploratory-modelling_files/figure-html/keys-near-plot-1.png" width="700"></p>
<p>You can read more about <code><a href="../reference/keys_near.html">keys_near()</a></code> in the <a href="http://brolgar.njtierney.com/articles/id-interesting-obs.html">Identifying interesting observations</a> vignette.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney, Di Cook, Tania Prvan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '48bc42eefc5234a6463c3b99e53dfda1',
    indexName: 'brolgar',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
