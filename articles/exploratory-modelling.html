<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exploratory Modelling • brolgar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exploratory Modelling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brolgar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/visualisation-gallery.html">Gallery</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/longitudinal-data-structures.html">Data Structures</a></li>
    <li><a class="dropdown-item" href="../articles/exploratory-modelling.html">Exploratory Modelling</a></li>
    <li><a class="dropdown-item" href="../articles/finding-features.html">Finding Features</a></li>
    <li><a class="dropdown-item" href="../articles/id-interesting-obs.html">Identify Interesting Observations</a></li>
    <li><a class="dropdown-item" href="../articles/mixed-effects-models.html">Exploring Mixed Effects Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/njtierney/brolgar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Exploratory Modelling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/njtierney/brolgar/blob/main/vignettes/exploratory-modelling.Rmd" class="external-link"><code>vignettes/exploratory-modelling.Rmd</code></a></small>
      <div class="d-none name"><code>exploratory-modelling.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/brolgar" class="external-link">brolgar</a></span><span class="op">)</span></span></code></pre></div>
<p>It can be useful to fit a model to explore your data. One technique
is to fit a linear model for each group in a dataset. For example, you
could fit a linear model for each key in the data.</p>
<p><code>brolgar</code> provides a helper function to help with this,
called <code><a href="../reference/key_slope.html">key_slope()</a></code>.</p>
<p><code><a href="../reference/key_slope.html">key_slope()</a></code> returns the intercept and slope estimate for
each key, given a linear model formula. We can get the number of
observations, and slope information for each individual to identify
those that are decreasing over time.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/key_slope.html">key_slope</a></span><span class="op">(</span><span class="va">wages</span>,<span class="va">ln_wages</span> <span class="op">~</span> <span class="va">xp</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 888 × 3</span></span></span>
<span><span class="co">#&gt;       id .intercept .slope_xp</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    31       1.41    0.101 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    36       2.04    0.058<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    53       2.29   -<span style="color: #BB0000;">0.358</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   122       1.93    0.037<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   134       2.03    0.083<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   145       1.59    0.046<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   155       1.66    0.086<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   173       1.61    0.100 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   206       1.73    0.180 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   207       1.62    0.088<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 878 more rows</span></span></span></code></pre></div>
<p>We can then join these summaries back to the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">wages_slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/key_slope.html">key_slope</a></span><span class="op">(</span><span class="va">wages</span>,<span class="va">ln_wages</span> <span class="op">~</span> <span class="va">xp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wages</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">wages_slope</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6,402 × 11</span></span></span>
<span><span class="co">#&gt;       id .intercept .slope_xp ln_wages    xp   ged xp_since_ged black hispanic</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    31       1.41    0.101      1.49 0.015     1        0.015     0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    31       1.41    0.101      1.43 0.715     1        0.715     0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    31       1.41    0.101      1.47 1.73      1        1.73      0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    31       1.41    0.101      1.75 2.77      1        2.77      0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    31       1.41    0.101      1.93 3.93      1        3.93      0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    31       1.41    0.101      1.71 4.95      1        4.95      0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    31       1.41    0.101      2.09 5.96      1        5.96      0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    31       1.41    0.101      2.13 6.98      1        6.98      0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    36       2.04    0.058<span style="text-decoration: underline;">8</span>     1.98 0.315     1        0.315     0        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    36       2.04    0.058<span style="text-decoration: underline;">8</span>     1.80 0.983     1        0.983     0        0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6,392 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: high_grade &lt;int&gt;, unemploy_rate &lt;dbl&gt;</span></span></span></code></pre></div>
<p>And highlight those individuals with a negative slope using
<code>gghighlight</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yutannihilation.github.io/gghighlight/" class="external-link">gghighlight</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">wages_slope</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># workaround for gghighlight + tsibble</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xp</span>, </span>
<span>             y <span class="op">=</span> <span class="va">ln_wages</span>, </span>
<span>             group <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html" class="external-link">gghighlight</a></span><span class="op">(</span><span class="va">.slope_xp</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="exploratory-modelling_files/figure-html/use-gg-highlight-1.png" width="700"></p>
<div class="section level2">
<h2 id="find-keys-near-other-summaries-with-keys_near">Find keys near other summaries with <code>keys_near()</code><a class="anchor" aria-label="anchor" href="#find-keys-near-other-summaries-with-keys_near"></a>
</h2>
<p>We might want to further summarise our exploratory modelling by
finding those slopes that are near a five number summary values:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wages_slope</span><span class="op">$</span><span class="va">.slope_xp</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's </span></span>
<span><span class="co">#&gt; -4.57692 -0.00189  0.04519  0.04490  0.08458 13.21569       38</span></span></code></pre></div>
<p>Finding those groups that are near these values can be surprisingly
challenging!</p>
<p><code>brolgar</code> makes it easier by providing the
<code><a href="../reference/keys_near.html">keys_near()</a></code> function. You tell it what the key is, what
variable you want to summarise by, and then by default it returns those
keys near the five number summary. Let’s return the keys near the
<code>.slope_xp</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wages_slope</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">id</span>,</span>
<span>            var <span class="op">=</span> <span class="va">.slope_xp</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 31 × 5</span></span></span>
<span><span class="co">#&gt;       id .slope_xp stat  stat_value stat_diff</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>092  -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span> q_25    -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>092  -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span> q_25    -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>092  -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span> q_25    -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>092  -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span> q_25    -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>092  -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span> q_25    -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>092  -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span> q_25    -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">89</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">6</span>770   0.084<span style="text-decoration: underline;">6</span>  q_75     0.084<span style="text-decoration: underline;">6</span>          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">6</span>770   0.084<span style="text-decoration: underline;">6</span>  q_75     0.084<span style="text-decoration: underline;">6</span>          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">6</span>770   0.084<span style="text-decoration: underline;">6</span>  q_75     0.084<span style="text-decoration: underline;">6</span>          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">6</span>770   0.084<span style="text-decoration: underline;">6</span>  q_75     0.084<span style="text-decoration: underline;">6</span>          0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more rows</span></span></span></code></pre></div>
<p>Here it returns the <code>id</code>, the <code>.slope_xp</code>, and
the statistic that it was closest to, and what the difference between
the slope_xp and the statistic.</p>
<p>You can visualise these summary keys by joining them back to the
data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wages_slope</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/keys_near.html">keys_near</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">id</span>,</span>
<span>            var <span class="op">=</span> <span class="va">.slope_xp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wages</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xp</span>,</span>
<span>             y <span class="op">=</span> <span class="va">ln_wages</span>,</span>
<span>             group <span class="op">=</span> <span class="va">id</span>,</span>
<span>             colour <span class="op">=</span> <span class="va">stat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exploratory-modelling_files/figure-html/keys-near-plot-1.png" width="700"></p>
<p>You can read more about <code><a href="../reference/keys_near.html">keys_near()</a></code> in the <a href="https://brolgar.njtierney.com/articles/id-interesting-obs.html" class="external-link">Identifying
interesting observations</a> vignette.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, Di Cook, Tania Prvan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
