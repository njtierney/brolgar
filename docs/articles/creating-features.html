<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating Features • brolgar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Creating Features">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brolgar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3.9100</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/creating-features.html">Creating Features</a>
    </li>
    <li>
      <a href="../articles/find-summary-keys.html">Finding summary keys</a>
    </li>
    <li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/longitudinal-data-structures.html">Longitudinal Data Structures</a>
    </li>
    <li>
      <a href="../articles/visualisation-gallery.html">Visualisation Gallery</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Creating Features</h1>
            
      
      
      <div class="hidden name"><code>creating-features.Rmd</code></div>

    </div>

    
    
<p>To create your own features or summaries to pass to <code>feasts</code>, you can provide a named list of functions. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(brolgar)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(feasts)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt; Loading required package: fablelite</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; Attaching package: 'feasts'</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; The following object is masked from 'package:grDevices':</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt;     X11</span></a>
<a class="sourceLine" id="cb1-9" title="9">feat_three &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">min =</span> min,</a>
<a class="sourceLine" id="cb1-10" title="10">                   <span class="dt">med =</span> median,</a>
<a class="sourceLine" id="cb1-11" title="11">                   <span class="dt">max =</span> max)</a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13">feat_three</a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt; $min</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt; function (..., na.rm = FALSE)  .Primitive("min")</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">#&gt; $med</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">#&gt; function (x, na.rm = FALSE, ...) </span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co">#&gt; UseMethod("median")</span></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">#&gt; &lt;bytecode: 0x7ffd2525a408&gt;</span></a>
<a class="sourceLine" id="cb1-21" title="21"><span class="co">#&gt; &lt;environment: namespace:stats&gt;</span></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co">#&gt; $max</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co">#&gt; function (..., na.rm = FALSE)  .Primitive("max")</span></a></code></pre></div>
<p>These are then passed to <code>features</code> like so:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">wages <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="st">  </span><span class="kw"><a href="https://fablelite.tidyverts.org/reference/features.html">features</a></span>(ln_wages, feat_three)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#&gt; # A tibble: 888 x 4</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt;       id   min   med   max</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt;  1    31 1.43   1.73  2.13</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt;  2    36 1.80   2.32  2.93</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt;  3    53 1.54   1.71  3.24</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt;  4   122 0.763  2.19  2.92</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt;  5   134 2.00   2.36  2.93</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt;  6   145 1.48   1.77  2.04</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">#&gt;  7   155 1.54   2.22  2.64</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">#&gt;  8   173 1.56   2.00  2.34</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">#&gt;  9   206 2.03   2.30  2.48</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co">#&gt; 10   207 1.58   2.15  2.66</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">#&gt; # … with 878 more rows</span></a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18">heights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="st">  </span><span class="kw"><a href="https://fablelite.tidyverts.org/reference/features.html">features</a></span>(height_cm, feat_three)</a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#&gt; # A tibble: 153 x 4</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">#&gt;    country       min   med   max</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co">#&gt;  1 Afghanistan  161.  167.  168.</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co">#&gt;  2 Albania      168.  170.  170.</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">#&gt;  3 Algeria      166.  169   171.</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">#&gt;  4 Angola       159.  167.  169.</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">#&gt;  5 Argentina    167.  168.  174.</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">#&gt;  6 Armenia      164.  169.  172.</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">#&gt;  7 Australia    170   172.  178.</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">#&gt;  8 Austria      162.  167.  179.</span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="co">#&gt;  9 Azerbaijan   170.  172.  172.</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co">#&gt; 10 Bahrain      161.  164.  164 </span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="co">#&gt; # … with 143 more rows</span></a></code></pre></div>
<p>Inside <code>brolgar</code>, the features are created with the following syntax:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">feat_five_num &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">min =</span> <span class="kw"><a href="../reference/b_summaries.html">b_min</a></span>(x, ...),</a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="dt">q25 =</span> <span class="kw"><a href="../reference/b_summaries.html">b_q25</a></span>(x, ...),</a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="dt">med =</span> <span class="kw"><a href="../reference/b_summaries.html">b_median</a></span>(x, ...),</a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="dt">q75 =</span> <span class="kw"><a href="../reference/b_summaries.html">b_q75</a></span>(x, ...),</a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="dt">max =</span> <span class="kw"><a href="../reference/b_summaries.html">b_max</a></span>(x, ...)</a>
<a class="sourceLine" id="cb3-8" title="8">  )</a>
<a class="sourceLine" id="cb3-9" title="9">}</a></code></pre></div>
<p>Here the functions <code>b_</code> are functions with a default of <code>na.rm = TRUE</code>, and in the cases of quantiles, they use <code>type = 8</code>, and <code>names = FALSE</code>.</p>
<div id="accessing-sets-of-features" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-sets-of-features" class="anchor"></a>Accessing sets of features</h2>
<p>You can now create a set of features with:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(fablelite)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="https://fablelite.tidyverts.org/reference/feature_set.html">feature_set</a></span>(<span class="dt">pkgs =</span> <span class="st">"brolgar"</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt; function(x, ...) {</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;   c(min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt;     med = b_median(x, ...), </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;     max = b_max(x, ...))</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; &lt;bytecode: 0x7ffd284c5400&gt;</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; function(x, ...) {</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt;   list(</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt;     min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt;     q25 = b_q25(x, ...),</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt;     med = b_median(x, ...),</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">#&gt;     q75 = b_q75(x, ...),</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">#&gt;     max = b_max(x, ...)</span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">#&gt; &lt;bytecode: 0x7ffd284ca750&gt;</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb4-26" title="26"><span class="co">#&gt; function(x, ...){</span></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="co">#&gt;   c(</span></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="co">#&gt;     min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co">#&gt;     max = b_max(x, ...),</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="co">#&gt;     range_diff = b_range_diff(x, ...),</span></a>
<a class="sourceLine" id="cb4-31" title="31"><span class="co">#&gt;     iqr = b_iqr(x, ...)</span></a>
<a class="sourceLine" id="cb4-32" title="32"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-33" title="33"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co">#&gt; &lt;bytecode: 0x7ffd284d4bb0&gt;</span></a>
<a class="sourceLine" id="cb4-35" title="35"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-36" title="36"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-37" title="37"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb4-38" title="38"><span class="co">#&gt; function(x, ...){</span></a>
<a class="sourceLine" id="cb4-39" title="39"><span class="co">#&gt;   c(</span></a>
<a class="sourceLine" id="cb4-40" title="40"><span class="co">#&gt;     var = b_var(x, ...),</span></a>
<a class="sourceLine" id="cb4-41" title="41"><span class="co">#&gt;     sd = b_sd(x, ...),</span></a>
<a class="sourceLine" id="cb4-42" title="42"><span class="co">#&gt;     mad = b_mad(x, ...),</span></a>
<a class="sourceLine" id="cb4-43" title="43"><span class="co">#&gt;     iqr = b_iqr(x, ...)</span></a>
<a class="sourceLine" id="cb4-44" title="44"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-45" title="45"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-46" title="46"><span class="co">#&gt; &lt;bytecode: 0x7ffd284deb40&gt;</span></a>
<a class="sourceLine" id="cb4-47" title="47"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-48" title="48"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-49" title="49"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb4-50" title="50"><span class="co">#&gt; function(x, ...){</span></a>
<a class="sourceLine" id="cb4-51" title="51"><span class="co">#&gt;   c(</span></a>
<a class="sourceLine" id="cb4-52" title="52"><span class="co">#&gt;     min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-53" title="53"><span class="co">#&gt;     max = b_max(x, ...),</span></a>
<a class="sourceLine" id="cb4-54" title="54"><span class="co">#&gt;     median = b_median(x, ...),</span></a>
<a class="sourceLine" id="cb4-55" title="55"><span class="co">#&gt;     mean = b_mean(x, ...),</span></a>
<a class="sourceLine" id="cb4-56" title="56"><span class="co">#&gt;     q25 = b_q25(x, ...),</span></a>
<a class="sourceLine" id="cb4-57" title="57"><span class="co">#&gt;     q75 = b_q75(x, ...),</span></a>
<a class="sourceLine" id="cb4-58" title="58"><span class="co">#&gt;     range = b_range(x, ...),</span></a>
<a class="sourceLine" id="cb4-59" title="59"><span class="co">#&gt;     range_diff = b_range_diff(x, ...),</span></a>
<a class="sourceLine" id="cb4-60" title="60"><span class="co">#&gt;     sd = b_sd(x, ...),</span></a>
<a class="sourceLine" id="cb4-61" title="61"><span class="co">#&gt;     var = b_var(x, ...),</span></a>
<a class="sourceLine" id="cb4-62" title="62"><span class="co">#&gt;     mad = b_mad(x, ...),</span></a>
<a class="sourceLine" id="cb4-63" title="63"><span class="co">#&gt;     iqr = b_iqr(x, ...),</span></a>
<a class="sourceLine" id="cb4-64" title="64"><span class="co">#&gt;     increase = increasing(x, ...),</span></a>
<a class="sourceLine" id="cb4-65" title="65"><span class="co">#&gt;     decrease = decreasing(x, ...), </span></a>
<a class="sourceLine" id="cb4-66" title="66"><span class="co">#&gt;     unvary = unvarying(x, ...)</span></a>
<a class="sourceLine" id="cb4-67" title="67"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-68" title="68"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-69" title="69"><span class="co">#&gt; &lt;bytecode: 0x7ffd284fbed8&gt;</span></a>
<a class="sourceLine" id="cb4-70" title="70"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-71" title="71"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-72" title="72"><span class="co">#&gt; [[6]]</span></a>
<a class="sourceLine" id="cb4-73" title="73"><span class="co">#&gt; function(x, ...) {</span></a>
<a class="sourceLine" id="cb4-74" title="74"><span class="co">#&gt;   c(increase = increasing(x, ...),</span></a>
<a class="sourceLine" id="cb4-75" title="75"><span class="co">#&gt;     decrease = decreasing(x, ...), </span></a>
<a class="sourceLine" id="cb4-76" title="76"><span class="co">#&gt;     unvary = unvarying(x, ...),</span></a>
<a class="sourceLine" id="cb4-77" title="77"><span class="co">#&gt;     monotonic = monotonic(x, ...))</span></a>
<a class="sourceLine" id="cb4-78" title="78"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-79" title="79"><span class="co">#&gt; &lt;bytecode: 0x7ffd2850e490&gt;</span></a>
<a class="sourceLine" id="cb4-80" title="80"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-81" title="81"><span class="kw"><a href="https://fablelite.tidyverts.org/reference/feature_set.html">feature_set</a></span>(<span class="dt">pkgs =</span> <span class="st">"feasts"</span>)</a>
<a class="sourceLine" id="cb4-82" title="82"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb4-83" title="83"><span class="co">#&gt; function (x, .period, s.window = 13, ...) </span></a>
<a class="sourceLine" id="cb4-84" title="84"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-85" title="85"><span class="co">#&gt;     dots &lt;- dots_list(...)</span></a>
<a class="sourceLine" id="cb4-86" title="86"><span class="co">#&gt;     dots &lt;- dots[names(dots) %in% names(formals(stats::stl))]</span></a>
<a class="sourceLine" id="cb4-87" title="87"><span class="co">#&gt;     season.args &lt;- list2(`:=`(!!(names(.period) %||% as.character(.period)), </span></a>
<a class="sourceLine" id="cb4-88" title="88"><span class="co">#&gt;         list(period = .period, s.window = s.window)))</span></a>
<a class="sourceLine" id="cb4-89" title="89"><span class="co">#&gt;     dcmp &lt;- eval_tidy(quo(estimate_stl(x, trend.args = list(), </span></a>
<a class="sourceLine" id="cb4-90" title="90"><span class="co">#&gt;         season.args = season.args, lowpass.args = list(), !!!dots)))</span></a>
<a class="sourceLine" id="cb4-91" title="91"><span class="co">#&gt;     trend &lt;- dcmp[["trend"]]</span></a>
<a class="sourceLine" id="cb4-92" title="92"><span class="co">#&gt;     remainder &lt;- dcmp[["remainder"]]</span></a>
<a class="sourceLine" id="cb4-93" title="93"><span class="co">#&gt;     season_adjust &lt;- dcmp[["season_adjust"]]</span></a>
<a class="sourceLine" id="cb4-94" title="94"><span class="co">#&gt;     seasonalities &lt;- dcmp[seq_len(length(dcmp) - 3) + 1]</span></a>
<a class="sourceLine" id="cb4-95" title="95"><span class="co">#&gt;     names(seasonalities) &lt;- sub("season_", "", names(seasonalities))</span></a>
<a class="sourceLine" id="cb4-96" title="96"><span class="co">#&gt;     var_e &lt;- var(remainder, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-97" title="97"><span class="co">#&gt;     n &lt;- length(x)</span></a>
<a class="sourceLine" id="cb4-98" title="98"><span class="co">#&gt;     d &lt;- (remainder - mean(remainder, na.rm = TRUE))^2</span></a>
<a class="sourceLine" id="cb4-99" title="99"><span class="co">#&gt;     var_loo &lt;- (var_e * (n - 1) - d)/(n - 2)</span></a>
<a class="sourceLine" id="cb4-100" title="100"><span class="co">#&gt;     spikiness &lt;- var(var_loo, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-101" title="101"><span class="co">#&gt;     tren.coef &lt;- coef(lm(trend ~ poly(seq(n), degree = 2L)))[2L:3L]</span></a>
<a class="sourceLine" id="cb4-102" title="102"><span class="co">#&gt;     linearity &lt;- tren.coef[[1L]]</span></a>
<a class="sourceLine" id="cb4-103" title="103"><span class="co">#&gt;     curvature &lt;- tren.coef[[2L]]</span></a>
<a class="sourceLine" id="cb4-104" title="104"><span class="co">#&gt;     trend_strength &lt;- max(0, min(1, 1 - var_e/var(season_adjust, </span></a>
<a class="sourceLine" id="cb4-105" title="105"><span class="co">#&gt;         na.rm = TRUE)))</span></a>
<a class="sourceLine" id="cb4-106" title="106"><span class="co">#&gt;     seasonal_strength &lt;- map_dbl(seasonalities, function(seas) {</span></a>
<a class="sourceLine" id="cb4-107" title="107"><span class="co">#&gt;         max(0, min(1, 1 - var_e/var(remainder + seas, na.rm = TRUE)))</span></a>
<a class="sourceLine" id="cb4-108" title="108"><span class="co">#&gt;     })</span></a>
<a class="sourceLine" id="cb4-109" title="109"><span class="co">#&gt;     names(seasonal_strength) &lt;- sprintf("seasonal_strength_%s", </span></a>
<a class="sourceLine" id="cb4-110" title="110"><span class="co">#&gt;         names(seasonalities))</span></a>
<a class="sourceLine" id="cb4-111" title="111"><span class="co">#&gt;     seasonal_peak &lt;- map_dbl(seasonalities, function(seas) {</span></a>
<a class="sourceLine" id="cb4-112" title="112"><span class="co">#&gt;         which.max(seas)%%.period</span></a>
<a class="sourceLine" id="cb4-113" title="113"><span class="co">#&gt;     })</span></a>
<a class="sourceLine" id="cb4-114" title="114"><span class="co">#&gt;     names(seasonal_peak) &lt;- sprintf("seasonal_peak_%s", names(seasonalities))</span></a>
<a class="sourceLine" id="cb4-115" title="115"><span class="co">#&gt;     seasonal_trough &lt;- map_dbl(seasonalities, function(seas) {</span></a>
<a class="sourceLine" id="cb4-116" title="116"><span class="co">#&gt;         which.min(seas)%%.period</span></a>
<a class="sourceLine" id="cb4-117" title="117"><span class="co">#&gt;     })</span></a>
<a class="sourceLine" id="cb4-118" title="118"><span class="co">#&gt;     names(seasonal_trough) &lt;- sprintf("seasonal_trough_%s", names(seasonalities))</span></a>
<a class="sourceLine" id="cb4-119" title="119"><span class="co">#&gt;     c(trend_strength = trend_strength, seasonal_strength, spikiness = spikiness, </span></a>
<a class="sourceLine" id="cb4-120" title="120"><span class="co">#&gt;         linearity = linearity, curvature = curvature, seasonal_peak, </span></a>
<a class="sourceLine" id="cb4-121" title="121"><span class="co">#&gt;         seasonal_trough)</span></a>
<a class="sourceLine" id="cb4-122" title="122"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-123" title="123"><span class="co">#&gt; &lt;bytecode: 0x7ffd290fd3f0&gt;</span></a>
<a class="sourceLine" id="cb4-124" title="124"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-125" title="125"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-126" title="126"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb4-127" title="127"><span class="co">#&gt; function (x, .period = 1, lag_max = NULL, ...) </span></a>
<a class="sourceLine" id="cb4-128" title="128"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-129" title="129"><span class="co">#&gt;     acfx &lt;- stats::acf(x, lag.max = lag_max %||% max(.period, </span></a>
<a class="sourceLine" id="cb4-130" title="130"><span class="co">#&gt;         10L), plot = FALSE, na.action = stats::na.pass, ...)</span></a>
<a class="sourceLine" id="cb4-131" title="131"><span class="co">#&gt;     acfdiff1x &lt;- stats::acf(diff(x, differences = 1), lag.max = lag_max %||% </span></a>
<a class="sourceLine" id="cb4-132" title="132"><span class="co">#&gt;         10L, plot = FALSE, na.action = stats::na.pass)</span></a>
<a class="sourceLine" id="cb4-133" title="133"><span class="co">#&gt;     acfdiff2x &lt;- stats::acf(diff(x, differences = 2), lag.max = lag_max %||% </span></a>
<a class="sourceLine" id="cb4-134" title="134"><span class="co">#&gt;         10L, plot = FALSE, na.action = stats::na.pass)</span></a>
<a class="sourceLine" id="cb4-135" title="135"><span class="co">#&gt;     acf_1 &lt;- acfx$acf[2L]</span></a>
<a class="sourceLine" id="cb4-136" title="136"><span class="co">#&gt;     sum_of_sq_acf10 &lt;- sum((acfx$acf[2L:11L])^2)</span></a>
<a class="sourceLine" id="cb4-137" title="137"><span class="co">#&gt;     diff1_acf1 &lt;- acfdiff1x$acf[2L]</span></a>
<a class="sourceLine" id="cb4-138" title="138"><span class="co">#&gt;     diff1_acf10 &lt;- sum((acfdiff1x$acf[-1L])^2)</span></a>
<a class="sourceLine" id="cb4-139" title="139"><span class="co">#&gt;     diff2_acf1 &lt;- acfdiff2x$acf[2L]</span></a>
<a class="sourceLine" id="cb4-140" title="140"><span class="co">#&gt;     diff2_acf10 &lt;- sum((acfdiff2x$acf[-1L])^2)</span></a>
<a class="sourceLine" id="cb4-141" title="141"><span class="co">#&gt;     output &lt;- c(acf1 = unname(acf_1), acf10 = unname(sum_of_sq_acf10), </span></a>
<a class="sourceLine" id="cb4-142" title="142"><span class="co">#&gt;         diff1_acf1 = unname(diff1_acf1), diff1_acf10 = unname(diff1_acf10), </span></a>
<a class="sourceLine" id="cb4-143" title="143"><span class="co">#&gt;         diff2_acf1 = unname(diff2_acf1), diff2_acf10 = unname(diff2_acf10))</span></a>
<a class="sourceLine" id="cb4-144" title="144"><span class="co">#&gt;     if (.period &gt; 1) {</span></a>
<a class="sourceLine" id="cb4-145" title="145"><span class="co">#&gt;         output &lt;- c(output, season_acf1 = unname(acfx$acf[.period + </span></a>
<a class="sourceLine" id="cb4-146" title="146"><span class="co">#&gt;             1L]))</span></a>
<a class="sourceLine" id="cb4-147" title="147"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-148" title="148"><span class="co">#&gt;     return(output)</span></a>
<a class="sourceLine" id="cb4-149" title="149"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-150" title="150"><span class="co">#&gt; &lt;bytecode: 0x7ffd29106580&gt;</span></a>
<a class="sourceLine" id="cb4-151" title="151"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-152" title="152"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-153" title="153"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb4-154" title="154"><span class="co">#&gt; function (x, .period = 1, lag_max = NULL, ...) </span></a>
<a class="sourceLine" id="cb4-155" title="155"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-156" title="156"><span class="co">#&gt;     pacfx &lt;- stats::pacf(x, lag.max = lag_max %||% max(.period, </span></a>
<a class="sourceLine" id="cb4-157" title="157"><span class="co">#&gt;         5L), plot = FALSE, ...)$acf</span></a>
<a class="sourceLine" id="cb4-158" title="158"><span class="co">#&gt;     pacf_5 &lt;- sum((pacfx[seq(5L)])^2)</span></a>
<a class="sourceLine" id="cb4-159" title="159"><span class="co">#&gt;     diff1_pacf_5 &lt;- sum((stats::pacf(diff(x, differences = 1), </span></a>
<a class="sourceLine" id="cb4-160" title="160"><span class="co">#&gt;         lag.max = lag_max %||% max(.period, 5L), plot = FALSE, </span></a>
<a class="sourceLine" id="cb4-161" title="161"><span class="co">#&gt;         ...)$acf)^2)</span></a>
<a class="sourceLine" id="cb4-162" title="162"><span class="co">#&gt;     diff2_pacf_5 &lt;- sum((stats::pacf(diff(x, differences = 2), </span></a>
<a class="sourceLine" id="cb4-163" title="163"><span class="co">#&gt;         lag.max = lag_max %||% max(.period, 5L), plot = FALSE, </span></a>
<a class="sourceLine" id="cb4-164" title="164"><span class="co">#&gt;         ...)$acf)^2)</span></a>
<a class="sourceLine" id="cb4-165" title="165"><span class="co">#&gt;     output &lt;- c(pacf5 = unname(pacf_5), diff1_pacf5 = unname(diff1_pacf_5), </span></a>
<a class="sourceLine" id="cb4-166" title="166"><span class="co">#&gt;         diff2_pacf5 = unname(diff2_pacf_5))</span></a>
<a class="sourceLine" id="cb4-167" title="167"><span class="co">#&gt;     if (.period &gt; 1) {</span></a>
<a class="sourceLine" id="cb4-168" title="168"><span class="co">#&gt;         output &lt;- c(output, season_pacf = pacfx[.period])</span></a>
<a class="sourceLine" id="cb4-169" title="169"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-170" title="170"><span class="co">#&gt;     return(output)</span></a>
<a class="sourceLine" id="cb4-171" title="171"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-172" title="172"><span class="co">#&gt; &lt;bytecode: 0x7ffd2910e900&gt;</span></a>
<a class="sourceLine" id="cb4-173" title="173"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-174" title="174"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-175" title="175"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb4-176" title="176"><span class="co">#&gt; function (x, lower = -1, upper = 2, .period) </span></a>
<a class="sourceLine" id="cb4-177" title="177"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-178" title="178"><span class="co">#&gt;     lambda &lt;- optimize(guer.cv, c(lower, upper), x = x, .period = max(2, </span></a>
<a class="sourceLine" id="cb4-179" title="179"><span class="co">#&gt;         .period))$minimum</span></a>
<a class="sourceLine" id="cb4-180" title="180"><span class="co">#&gt;     c(lambda_guerrero = lambda)</span></a>
<a class="sourceLine" id="cb4-181" title="181"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-182" title="182"><span class="co">#&gt; &lt;bytecode: 0x7ffd291146d0&gt;</span></a>
<a class="sourceLine" id="cb4-183" title="183"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-184" title="184"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-185" title="185"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb4-186" title="186"><span class="co">#&gt; function (x, type = c("mu", "tau"), lags = c("short", "long", </span></a>
<a class="sourceLine" id="cb4-187" title="187"><span class="co">#&gt;     "nil"), ...) </span></a>
<a class="sourceLine" id="cb4-188" title="188"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-189" title="189"><span class="co">#&gt;     require_package("urca")</span></a>
<a class="sourceLine" id="cb4-190" title="190"><span class="co">#&gt;     result &lt;- urca::ur.kpss(x, type = type, lags = lags, ...)</span></a>
<a class="sourceLine" id="cb4-191" title="191"><span class="co">#&gt;     pval &lt;- stats::approx(result@cval[1, ], as.numeric(sub("pct", </span></a>
<a class="sourceLine" id="cb4-192" title="192"><span class="co">#&gt;         "", colnames(result@cval)))/100, xout = result@teststat[1], </span></a>
<a class="sourceLine" id="cb4-193" title="193"><span class="co">#&gt;         rule = 2)$y</span></a>
<a class="sourceLine" id="cb4-194" title="194"><span class="co">#&gt;     c(kpss_stat = result@teststat, kpss_pvalue = pval)</span></a>
<a class="sourceLine" id="cb4-195" title="195"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-196" title="196"><span class="co">#&gt; &lt;bytecode: 0x7ffd2911a040&gt;</span></a>
<a class="sourceLine" id="cb4-197" title="197"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-198" title="198"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-199" title="199"><span class="co">#&gt; [[6]]</span></a>
<a class="sourceLine" id="cb4-200" title="200"><span class="co">#&gt; function (x, type = c("Z-tau", "Z-alpha"), model = c("constant", </span></a>
<a class="sourceLine" id="cb4-201" title="201"><span class="co">#&gt;     "trend"), lags = c("short", "long"), ...) </span></a>
<a class="sourceLine" id="cb4-202" title="202"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-203" title="203"><span class="co">#&gt;     require_package("urca")</span></a>
<a class="sourceLine" id="cb4-204" title="204"><span class="co">#&gt;     result &lt;- urca::ur.pp(x, type = match.arg(type), model = match.arg(model), </span></a>
<a class="sourceLine" id="cb4-205" title="205"><span class="co">#&gt;         lags = match.arg(lags), ...)</span></a>
<a class="sourceLine" id="cb4-206" title="206"><span class="co">#&gt;     pval &lt;- stats::approx(result@cval[1, ], as.numeric(sub("pct", </span></a>
<a class="sourceLine" id="cb4-207" title="207"><span class="co">#&gt;         "", colnames(result@cval)))/100, xout = result@teststat[1], </span></a>
<a class="sourceLine" id="cb4-208" title="208"><span class="co">#&gt;         rule = 2)$y</span></a>
<a class="sourceLine" id="cb4-209" title="209"><span class="co">#&gt;     c(pp_stat = result@teststat, pp_pvalue = pval)</span></a>
<a class="sourceLine" id="cb4-210" title="210"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-211" title="211"><span class="co">#&gt; &lt;bytecode: 0x7ffd291254d0&gt;</span></a>
<a class="sourceLine" id="cb4-212" title="212"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-213" title="213"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-214" title="214"><span class="co">#&gt; [[7]]</span></a>
<a class="sourceLine" id="cb4-215" title="215"><span class="co">#&gt; function (x, alpha = 0.05, unitroot_fn = ~unitroot_kpss(.)["kpss_pvalue"], </span></a>
<a class="sourceLine" id="cb4-216" title="216"><span class="co">#&gt;     differences = 0:2, ...) </span></a>
<a class="sourceLine" id="cb4-217" title="217"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-218" title="218"><span class="co">#&gt;     unitroot_fn &lt;- as_function(unitroot_fn)</span></a>
<a class="sourceLine" id="cb4-219" title="219"><span class="co">#&gt;     diff &lt;- function(x, differences, ...) {</span></a>
<a class="sourceLine" id="cb4-220" title="220"><span class="co">#&gt;         if (differences == 0) </span></a>
<a class="sourceLine" id="cb4-221" title="221"><span class="co">#&gt;             return(x)</span></a>
<a class="sourceLine" id="cb4-222" title="222"><span class="co">#&gt;         base::diff(x, differences = differences, ...)</span></a>
<a class="sourceLine" id="cb4-223" title="223"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-224" title="224"><span class="co">#&gt;     keep &lt;- map_lgl(differences, function(.x) {</span></a>
<a class="sourceLine" id="cb4-225" title="225"><span class="co">#&gt;         dx &lt;- diff(x, differences = .x)</span></a>
<a class="sourceLine" id="cb4-226" title="226"><span class="co">#&gt;         !all(is.na(dx))</span></a>
<a class="sourceLine" id="cb4-227" title="227"><span class="co">#&gt;     })</span></a>
<a class="sourceLine" id="cb4-228" title="228"><span class="co">#&gt;     differences &lt;- differences[keep]</span></a>
<a class="sourceLine" id="cb4-229" title="229"><span class="co">#&gt;     keep &lt;- map_lgl(differences[-1] - 1, function(.x) {</span></a>
<a class="sourceLine" id="cb4-230" title="230"><span class="co">#&gt;         unitroot_fn(diff(x, differences = .x), ...) &lt; alpha</span></a>
<a class="sourceLine" id="cb4-231" title="231"><span class="co">#&gt;     })</span></a>
<a class="sourceLine" id="cb4-232" title="232"><span class="co">#&gt;     c(ndiffs = max(differences[c(TRUE, keep)], na.rm = TRUE))</span></a>
<a class="sourceLine" id="cb4-233" title="233"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-234" title="234"><span class="co">#&gt; &lt;bytecode: 0x7ffd29128270&gt;</span></a>
<a class="sourceLine" id="cb4-235" title="235"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-236" title="236"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-237" title="237"><span class="co">#&gt; [[8]]</span></a>
<a class="sourceLine" id="cb4-238" title="238"><span class="co">#&gt; function (x, alpha = 0.05, unitroot_fn = ~feat_stl(., .period)[2] &lt; </span></a>
<a class="sourceLine" id="cb4-239" title="239"><span class="co">#&gt;     0.64, differences = 0:2, .period = 1, ...) </span></a>
<a class="sourceLine" id="cb4-240" title="240"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-241" title="241"><span class="co">#&gt;     if (.period == 1) </span></a>
<a class="sourceLine" id="cb4-242" title="242"><span class="co">#&gt;         return(c(nsdiffs = min(differences)))</span></a>
<a class="sourceLine" id="cb4-243" title="243"><span class="co">#&gt;     unitroot_fn &lt;- as_function(unitroot_fn)</span></a>
<a class="sourceLine" id="cb4-244" title="244"><span class="co">#&gt;     environment(unitroot_fn) &lt;- new_environment(parent = get_env(unitroot_fn))</span></a>
<a class="sourceLine" id="cb4-245" title="245"><span class="co">#&gt;     environment(unitroot_fn)$.period &lt;- .period</span></a>
<a class="sourceLine" id="cb4-246" title="246"><span class="co">#&gt;     diff &lt;- function(x, differences, ...) {</span></a>
<a class="sourceLine" id="cb4-247" title="247"><span class="co">#&gt;         if (differences == 0) </span></a>
<a class="sourceLine" id="cb4-248" title="248"><span class="co">#&gt;             return(x)</span></a>
<a class="sourceLine" id="cb4-249" title="249"><span class="co">#&gt;         base::diff(x, differences = differences, ...)</span></a>
<a class="sourceLine" id="cb4-250" title="250"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-251" title="251"><span class="co">#&gt;     keep &lt;- map_lgl(differences, function(.x) {</span></a>
<a class="sourceLine" id="cb4-252" title="252"><span class="co">#&gt;         dx &lt;- diff(x, lag = .period, differences = .x)</span></a>
<a class="sourceLine" id="cb4-253" title="253"><span class="co">#&gt;         !all(is.na(dx))</span></a>
<a class="sourceLine" id="cb4-254" title="254"><span class="co">#&gt;     })</span></a>
<a class="sourceLine" id="cb4-255" title="255"><span class="co">#&gt;     differences &lt;- differences[keep]</span></a>
<a class="sourceLine" id="cb4-256" title="256"><span class="co">#&gt;     keep &lt;- map_lgl(differences[-1] - 1, function(.x) {</span></a>
<a class="sourceLine" id="cb4-257" title="257"><span class="co">#&gt;         unitroot_fn(diff(x, lag = .period, differences = .x)) &lt; </span></a>
<a class="sourceLine" id="cb4-258" title="258"><span class="co">#&gt;             alpha</span></a>
<a class="sourceLine" id="cb4-259" title="259"><span class="co">#&gt;     })</span></a>
<a class="sourceLine" id="cb4-260" title="260"><span class="co">#&gt;     c(nsdiffs = max(differences[c(TRUE, keep)], na.rm = TRUE))</span></a>
<a class="sourceLine" id="cb4-261" title="261"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-262" title="262"><span class="co">#&gt; &lt;bytecode: 0x7ffd29133968&gt;</span></a>
<a class="sourceLine" id="cb4-263" title="263"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-264" title="264"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-265" title="265"><span class="co">#&gt; [[9]]</span></a>
<a class="sourceLine" id="cb4-266" title="266"><span class="co">#&gt; function (x, lag = 1, dof = 0, ...) </span></a>
<a class="sourceLine" id="cb4-267" title="267"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-268" title="268"><span class="co">#&gt;     out &lt;- stats::Box.test(x, lag = lag, type = "Box-Pierce", </span></a>
<a class="sourceLine" id="cb4-269" title="269"><span class="co">#&gt;         fitdf = dof)</span></a>
<a class="sourceLine" id="cb4-270" title="270"><span class="co">#&gt;     c(bp_stat = unname(out$statistic), bp_pvalue = out$p.value)</span></a>
<a class="sourceLine" id="cb4-271" title="271"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-272" title="272"><span class="co">#&gt; &lt;bytecode: 0x7ffd291380b0&gt;</span></a>
<a class="sourceLine" id="cb4-273" title="273"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-274" title="274"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-275" title="275"><span class="co">#&gt; [[10]]</span></a>
<a class="sourceLine" id="cb4-276" title="276"><span class="co">#&gt; function (x, lag = 1, dof = 0, ...) </span></a>
<a class="sourceLine" id="cb4-277" title="277"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-278" title="278"><span class="co">#&gt;     out &lt;- stats::Box.test(x, lag = lag, type = "Ljung-Box", </span></a>
<a class="sourceLine" id="cb4-279" title="279"><span class="co">#&gt;         fitdf = dof)</span></a>
<a class="sourceLine" id="cb4-280" title="280"><span class="co">#&gt;     c(lb_stat = unname(out$statistic), lb_pvalue = out$p.value)</span></a>
<a class="sourceLine" id="cb4-281" title="281"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-282" title="282"><span class="co">#&gt; &lt;bytecode: 0x7ffd2913fc78&gt;</span></a>
<a class="sourceLine" id="cb4-283" title="283"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-284" title="284"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-285" title="285"><span class="co">#&gt; [[11]]</span></a>
<a class="sourceLine" id="cb4-286" title="286"><span class="co">#&gt; function (x, .size = NULL, .period = 1) </span></a>
<a class="sourceLine" id="cb4-287" title="287"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-288" title="288"><span class="co">#&gt;     if (is.null(.size)) {</span></a>
<a class="sourceLine" id="cb4-289" title="289"><span class="co">#&gt;         .size &lt;- ifelse(.period == 1, 10, .period)</span></a>
<a class="sourceLine" id="cb4-290" title="290"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-291" title="291"><span class="co">#&gt;     x &lt;- scale(x, center = TRUE, scale = TRUE)</span></a>
<a class="sourceLine" id="cb4-292" title="292"><span class="co">#&gt;     varx &lt;- tsibble::tile_dbl(x, var, na.rm = TRUE, .size = .size)</span></a>
<a class="sourceLine" id="cb4-293" title="293"><span class="co">#&gt;     if (length(x) &lt; 2 * .size) {</span></a>
<a class="sourceLine" id="cb4-294" title="294"><span class="co">#&gt;         lumpiness &lt;- 0</span></a>
<a class="sourceLine" id="cb4-295" title="295"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-296" title="296"><span class="co">#&gt;     else {</span></a>
<a class="sourceLine" id="cb4-297" title="297"><span class="co">#&gt;         lumpiness &lt;- var(varx, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-298" title="298"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-299" title="299"><span class="co">#&gt;     return(c(var_tiled_var = lumpiness))</span></a>
<a class="sourceLine" id="cb4-300" title="300"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-301" title="301"><span class="co">#&gt; &lt;bytecode: 0x7ffd29145ab8&gt;</span></a>
<a class="sourceLine" id="cb4-302" title="302"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-303" title="303"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-304" title="304"><span class="co">#&gt; [[12]]</span></a>
<a class="sourceLine" id="cb4-305" title="305"><span class="co">#&gt; function (x, .size = NULL, .period = 1) </span></a>
<a class="sourceLine" id="cb4-306" title="306"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-307" title="307"><span class="co">#&gt;     if (is.null(.size)) {</span></a>
<a class="sourceLine" id="cb4-308" title="308"><span class="co">#&gt;         .size &lt;- ifelse(.period == 1, 10, .period)</span></a>
<a class="sourceLine" id="cb4-309" title="309"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-310" title="310"><span class="co">#&gt;     x &lt;- scale(x, center = TRUE, scale = TRUE)</span></a>
<a class="sourceLine" id="cb4-311" title="311"><span class="co">#&gt;     meanx &lt;- tsibble::tile_dbl(x, mean, na.rm = TRUE, .size = .size)</span></a>
<a class="sourceLine" id="cb4-312" title="312"><span class="co">#&gt;     if (length(x) &lt; 2 * .size) {</span></a>
<a class="sourceLine" id="cb4-313" title="313"><span class="co">#&gt;         stability &lt;- 0</span></a>
<a class="sourceLine" id="cb4-314" title="314"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-315" title="315"><span class="co">#&gt;     else {</span></a>
<a class="sourceLine" id="cb4-316" title="316"><span class="co">#&gt;         stability &lt;- var(meanx, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-317" title="317"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-318" title="318"><span class="co">#&gt;     return(c(var_tiled_mean = stability))</span></a>
<a class="sourceLine" id="cb4-319" title="319"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-320" title="320"><span class="co">#&gt; &lt;bytecode: 0x7ffd29148660&gt;</span></a>
<a class="sourceLine" id="cb4-321" title="321"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-322" title="322"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-323" title="323"><span class="co">#&gt; [[13]]</span></a>
<a class="sourceLine" id="cb4-324" title="324"><span class="co">#&gt; function (x, .size = NULL, .period = 1) </span></a>
<a class="sourceLine" id="cb4-325" title="325"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-326" title="326"><span class="co">#&gt;     if (is.null(.size)) {</span></a>
<a class="sourceLine" id="cb4-327" title="327"><span class="co">#&gt;         .size &lt;- ifelse(.period == 1, 10, .period)</span></a>
<a class="sourceLine" id="cb4-328" title="328"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-329" title="329"><span class="co">#&gt;     rollmean &lt;- tsibble::slide_dbl(x, mean, .size = .size, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-330" title="330"><span class="co">#&gt;     means &lt;- abs(diff(rollmean, .size))</span></a>
<a class="sourceLine" id="cb4-331" title="331"><span class="co">#&gt;     if (length(means) == 0L) {</span></a>
<a class="sourceLine" id="cb4-332" title="332"><span class="co">#&gt;         maxmeans &lt;- 0</span></a>
<a class="sourceLine" id="cb4-333" title="333"><span class="co">#&gt;         maxidx &lt;- NA_real_</span></a>
<a class="sourceLine" id="cb4-334" title="334"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-335" title="335"><span class="co">#&gt;     else if (all(is.na(means))) {</span></a>
<a class="sourceLine" id="cb4-336" title="336"><span class="co">#&gt;         maxmeans &lt;- NA_real_</span></a>
<a class="sourceLine" id="cb4-337" title="337"><span class="co">#&gt;         maxidx &lt;- NA_real_</span></a>
<a class="sourceLine" id="cb4-338" title="338"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-339" title="339"><span class="co">#&gt;     else {</span></a>
<a class="sourceLine" id="cb4-340" title="340"><span class="co">#&gt;         maxmeans &lt;- max(means, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-341" title="341"><span class="co">#&gt;         maxidx &lt;- which.max(means) + 1L</span></a>
<a class="sourceLine" id="cb4-342" title="342"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-343" title="343"><span class="co">#&gt;     return(c(shift_level_max = maxmeans, shift_level_index = maxidx))</span></a>
<a class="sourceLine" id="cb4-344" title="344"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-345" title="345"><span class="co">#&gt; &lt;bytecode: 0x7ffd29150ac0&gt;</span></a>
<a class="sourceLine" id="cb4-346" title="346"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-347" title="347"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-348" title="348"><span class="co">#&gt; [[14]]</span></a>
<a class="sourceLine" id="cb4-349" title="349"><span class="co">#&gt; function (x, .size = NULL, .period = 1) </span></a>
<a class="sourceLine" id="cb4-350" title="350"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-351" title="351"><span class="co">#&gt;     if (is.null(.size)) {</span></a>
<a class="sourceLine" id="cb4-352" title="352"><span class="co">#&gt;         .size &lt;- ifelse(.period == 1, 10, .period)</span></a>
<a class="sourceLine" id="cb4-353" title="353"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-354" title="354"><span class="co">#&gt;     rollvar &lt;- tsibble::slide_dbl(x, var, .size = .size, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-355" title="355"><span class="co">#&gt;     vars &lt;- abs(diff(rollvar, .size))</span></a>
<a class="sourceLine" id="cb4-356" title="356"><span class="co">#&gt;     if (length(vars) == 0L) {</span></a>
<a class="sourceLine" id="cb4-357" title="357"><span class="co">#&gt;         maxvar &lt;- 0</span></a>
<a class="sourceLine" id="cb4-358" title="358"><span class="co">#&gt;         maxidx &lt;- NA_real_</span></a>
<a class="sourceLine" id="cb4-359" title="359"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-360" title="360"><span class="co">#&gt;     else if (all(is.na(vars))) {</span></a>
<a class="sourceLine" id="cb4-361" title="361"><span class="co">#&gt;         maxvar &lt;- NA_real_</span></a>
<a class="sourceLine" id="cb4-362" title="362"><span class="co">#&gt;         maxidx &lt;- NA_real_</span></a>
<a class="sourceLine" id="cb4-363" title="363"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-364" title="364"><span class="co">#&gt;     else {</span></a>
<a class="sourceLine" id="cb4-365" title="365"><span class="co">#&gt;         maxvar &lt;- max(vars, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-366" title="366"><span class="co">#&gt;         maxidx &lt;- which.max(vars) + 1L</span></a>
<a class="sourceLine" id="cb4-367" title="367"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-368" title="368"><span class="co">#&gt;     return(c(shift_var_max = maxvar, shift_var_index = maxidx))</span></a>
<a class="sourceLine" id="cb4-369" title="369"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-370" title="370"><span class="co">#&gt; &lt;bytecode: 0x7ffd29159620&gt;</span></a>
<a class="sourceLine" id="cb4-371" title="371"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-372" title="372"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-373" title="373"><span class="co">#&gt; [[15]]</span></a>
<a class="sourceLine" id="cb4-374" title="374"><span class="co">#&gt; function (x, .size = NULL, .period = 1) </span></a>
<a class="sourceLine" id="cb4-375" title="375"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-376" title="376"><span class="co">#&gt;     if (is.null(.size)) {</span></a>
<a class="sourceLine" id="cb4-377" title="377"><span class="co">#&gt;         .size &lt;- ifelse(.period == 1, 10, .period)</span></a>
<a class="sourceLine" id="cb4-378" title="378"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-379" title="379"><span class="co">#&gt;     gw &lt;- 100</span></a>
<a class="sourceLine" id="cb4-380" title="380"><span class="co">#&gt;     xgrid &lt;- seq(min(x, na.rm = TRUE), max(x, na.rm = TRUE), </span></a>
<a class="sourceLine" id="cb4-381" title="381"><span class="co">#&gt;         length = gw)</span></a>
<a class="sourceLine" id="cb4-382" title="382"><span class="co">#&gt;     grid &lt;- xgrid[2L] - xgrid[1L]</span></a>
<a class="sourceLine" id="cb4-383" title="383"><span class="co">#&gt;     tmpx &lt;- x[!is.na(x)]</span></a>
<a class="sourceLine" id="cb4-384" title="384"><span class="co">#&gt;     bw &lt;- stats::bw.nrd0(tmpx)</span></a>
<a class="sourceLine" id="cb4-385" title="385"><span class="co">#&gt;     lenx &lt;- length(x)</span></a>
<a class="sourceLine" id="cb4-386" title="386"><span class="co">#&gt;     if (lenx &lt;= (2 * .size)) {</span></a>
<a class="sourceLine" id="cb4-387" title="387"><span class="co">#&gt;         abort("length of `x` is too short for `.size`.")</span></a>
<a class="sourceLine" id="cb4-388" title="388"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-389" title="389"><span class="co">#&gt;     densities &lt;- map(xgrid, function(xgrid) stats::dnorm(xgrid, </span></a>
<a class="sourceLine" id="cb4-390" title="390"><span class="co">#&gt;         mean = x, sd = bw))</span></a>
<a class="sourceLine" id="cb4-391" title="391"><span class="co">#&gt;     densities &lt;- map(densities, pmax, stats::dnorm(38))</span></a>
<a class="sourceLine" id="cb4-392" title="392"><span class="co">#&gt;     rmean &lt;- map(densities, function(x) tsibble::slide_dbl(x, </span></a>
<a class="sourceLine" id="cb4-393" title="393"><span class="co">#&gt;         mean, .size = .size, na.rm = TRUE, .align = "right")) %&gt;% </span></a>
<a class="sourceLine" id="cb4-394" title="394"><span class="co">#&gt;         transpose() %&gt;% map(unlist)</span></a>
<a class="sourceLine" id="cb4-395" title="395"><span class="co">#&gt;     kl &lt;- map2_dbl(rmean[seq_len(lenx - .size)], rmean[seq_len(lenx - </span></a>
<a class="sourceLine" id="cb4-396" title="396"><span class="co">#&gt;         .size) + .size], function(x, y) sum(x * (log(x) - log(y)) * </span></a>
<a class="sourceLine" id="cb4-397" title="397"><span class="co">#&gt;         grid, na.rm = TRUE))</span></a>
<a class="sourceLine" id="cb4-398" title="398"><span class="co">#&gt;     diffkl &lt;- diff(kl, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-399" title="399"><span class="co">#&gt;     if (length(diffkl) == 0L) {</span></a>
<a class="sourceLine" id="cb4-400" title="400"><span class="co">#&gt;         diffkl &lt;- 0</span></a>
<a class="sourceLine" id="cb4-401" title="401"><span class="co">#&gt;         maxidx &lt;- NA_real_</span></a>
<a class="sourceLine" id="cb4-402" title="402"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-403" title="403"><span class="co">#&gt;     else {</span></a>
<a class="sourceLine" id="cb4-404" title="404"><span class="co">#&gt;         maxidx &lt;- which.max(diffkl) + 1L</span></a>
<a class="sourceLine" id="cb4-405" title="405"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-406" title="406"><span class="co">#&gt;     return(c(shift_kl_max = max(diffkl, na.rm = TRUE), shift_kl_index = maxidx))</span></a>
<a class="sourceLine" id="cb4-407" title="407"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-408" title="408"><span class="co">#&gt; &lt;bytecode: 0x7ffd2915c388&gt;</span></a>
<a class="sourceLine" id="cb4-409" title="409"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-410" title="410"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-411" title="411"><span class="co">#&gt; [[16]]</span></a>
<a class="sourceLine" id="cb4-412" title="412"><span class="co">#&gt; function (x, ...) </span></a>
<a class="sourceLine" id="cb4-413" title="413"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-414" title="414"><span class="co">#&gt;     require_package("ForeCA")</span></a>
<a class="sourceLine" id="cb4-415" title="415"><span class="co">#&gt;     entropy &lt;- ForeCA::spectral_entropy(na.contiguous(x), ...)[1L]</span></a>
<a class="sourceLine" id="cb4-416" title="416"><span class="co">#&gt;     return(c(spectral_entropy = entropy))</span></a>
<a class="sourceLine" id="cb4-417" title="417"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-418" title="418"><span class="co">#&gt; &lt;bytecode: 0x7ffd29169690&gt;</span></a>
<a class="sourceLine" id="cb4-419" title="419"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-420" title="420"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-421" title="421"><span class="co">#&gt; [[17]]</span></a>
<a class="sourceLine" id="cb4-422" title="422"><span class="co">#&gt; function (x) </span></a>
<a class="sourceLine" id="cb4-423" title="423"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-424" title="424"><span class="co">#&gt;     midline &lt;- median(x, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-425" title="425"><span class="co">#&gt;     ab &lt;- x &lt;= midline</span></a>
<a class="sourceLine" id="cb4-426" title="426"><span class="co">#&gt;     lenx &lt;- length(x)</span></a>
<a class="sourceLine" id="cb4-427" title="427"><span class="co">#&gt;     p1 &lt;- ab[1:(lenx - 1)]</span></a>
<a class="sourceLine" id="cb4-428" title="428"><span class="co">#&gt;     p2 &lt;- ab[2:lenx]</span></a>
<a class="sourceLine" id="cb4-429" title="429"><span class="co">#&gt;     cross &lt;- (p1 &amp; !p2) | (p2 &amp; !p1)</span></a>
<a class="sourceLine" id="cb4-430" title="430"><span class="co">#&gt;     c(n_crossing_points = sum(cross, na.rm = TRUE))</span></a>
<a class="sourceLine" id="cb4-431" title="431"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-432" title="432"><span class="co">#&gt; &lt;bytecode: 0x7ffd2916c5f0&gt;</span></a>
<a class="sourceLine" id="cb4-433" title="433"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-434" title="434"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-435" title="435"><span class="co">#&gt; [[18]]</span></a>
<a class="sourceLine" id="cb4-436" title="436"><span class="co">#&gt; function (x) </span></a>
<a class="sourceLine" id="cb4-437" title="437"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-438" title="438"><span class="co">#&gt;     cutx &lt;- cut(x, breaks = 10, include.lowest = TRUE, labels = FALSE)</span></a>
<a class="sourceLine" id="cb4-439" title="439"><span class="co">#&gt;     rlex &lt;- rle(cutx)</span></a>
<a class="sourceLine" id="cb4-440" title="440"><span class="co">#&gt;     return(c(n_flat_spots = max(rlex$lengths)))</span></a>
<a class="sourceLine" id="cb4-441" title="441"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-442" title="442"><span class="co">#&gt; &lt;bytecode: 0x7ffd29177460&gt;</span></a>
<a class="sourceLine" id="cb4-443" title="443"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-444" title="444"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-445" title="445"><span class="co">#&gt; [[19]]</span></a>
<a class="sourceLine" id="cb4-446" title="446"><span class="co">#&gt; function (x) </span></a>
<a class="sourceLine" id="cb4-447" title="447"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-448" title="448"><span class="co">#&gt;     require_package("fracdiff")</span></a>
<a class="sourceLine" id="cb4-449" title="449"><span class="co">#&gt;     return(c(coef_hurst = suppressWarnings(fracdiff::fracdiff(na.contiguous(x), </span></a>
<a class="sourceLine" id="cb4-450" title="450"><span class="co">#&gt;         0, 0)[["d"]] + 0.5)))</span></a>
<a class="sourceLine" id="cb4-451" title="451"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-452" title="452"><span class="co">#&gt; &lt;bytecode: 0x7ffd2917b3f0&gt;</span></a>
<a class="sourceLine" id="cb4-453" title="453"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-454" title="454"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-455" title="455"><span class="co">#&gt; [[20]]</span></a>
<a class="sourceLine" id="cb4-456" title="456"><span class="co">#&gt; function (x, lags = 12, demean = TRUE) </span></a>
<a class="sourceLine" id="cb4-457" title="457"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-458" title="458"><span class="co">#&gt;     if (length(x) &lt;= 13) {</span></a>
<a class="sourceLine" id="cb4-459" title="459"><span class="co">#&gt;         return(c(arch_lm = NA_real_))</span></a>
<a class="sourceLine" id="cb4-460" title="460"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-461" title="461"><span class="co">#&gt;     if (demean) {</span></a>
<a class="sourceLine" id="cb4-462" title="462"><span class="co">#&gt;         x &lt;- x - mean(x, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb4-463" title="463"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-464" title="464"><span class="co">#&gt;     mat &lt;- embed(x^2, lags + 1)</span></a>
<a class="sourceLine" id="cb4-465" title="465"><span class="co">#&gt;     fit &lt;- lm(mat[, 1] ~ mat[, -1])</span></a>
<a class="sourceLine" id="cb4-466" title="466"><span class="co">#&gt;     arch.lm &lt;- summary(fit)</span></a>
<a class="sourceLine" id="cb4-467" title="467"><span class="co">#&gt;     c(stat_arch_lm = arch.lm$r.squared)</span></a>
<a class="sourceLine" id="cb4-468" title="468"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-469" title="469"><span class="co">#&gt; &lt;bytecode: 0x7ffd2917f310&gt;</span></a>
<a class="sourceLine" id="cb4-470" title="470"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a>
<a class="sourceLine" id="cb4-471" title="471"><span class="kw"><a href="https://fablelite.tidyverts.org/reference/feature_set.html">feature_set</a></span>(<span class="dt">tag =</span> <span class="st">"summary"</span>)</a>
<a class="sourceLine" id="cb4-472" title="472"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb4-473" title="473"><span class="co">#&gt; function(x, ...) {</span></a>
<a class="sourceLine" id="cb4-474" title="474"><span class="co">#&gt;   c(min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-475" title="475"><span class="co">#&gt;     med = b_median(x, ...), </span></a>
<a class="sourceLine" id="cb4-476" title="476"><span class="co">#&gt;     max = b_max(x, ...))</span></a>
<a class="sourceLine" id="cb4-477" title="477"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-478" title="478"><span class="co">#&gt; &lt;bytecode: 0x7ffd284c5400&gt;</span></a>
<a class="sourceLine" id="cb4-479" title="479"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-480" title="480"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-481" title="481"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb4-482" title="482"><span class="co">#&gt; function(x, ...) {</span></a>
<a class="sourceLine" id="cb4-483" title="483"><span class="co">#&gt;   list(</span></a>
<a class="sourceLine" id="cb4-484" title="484"><span class="co">#&gt;     min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-485" title="485"><span class="co">#&gt;     q25 = b_q25(x, ...),</span></a>
<a class="sourceLine" id="cb4-486" title="486"><span class="co">#&gt;     med = b_median(x, ...),</span></a>
<a class="sourceLine" id="cb4-487" title="487"><span class="co">#&gt;     q75 = b_q75(x, ...),</span></a>
<a class="sourceLine" id="cb4-488" title="488"><span class="co">#&gt;     max = b_max(x, ...)</span></a>
<a class="sourceLine" id="cb4-489" title="489"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-490" title="490"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-491" title="491"><span class="co">#&gt; &lt;bytecode: 0x7ffd284ca750&gt;</span></a>
<a class="sourceLine" id="cb4-492" title="492"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-493" title="493"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-494" title="494"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb4-495" title="495"><span class="co">#&gt; function(x, ...){</span></a>
<a class="sourceLine" id="cb4-496" title="496"><span class="co">#&gt;   c(</span></a>
<a class="sourceLine" id="cb4-497" title="497"><span class="co">#&gt;     min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-498" title="498"><span class="co">#&gt;     max = b_max(x, ...),</span></a>
<a class="sourceLine" id="cb4-499" title="499"><span class="co">#&gt;     range_diff = b_range_diff(x, ...),</span></a>
<a class="sourceLine" id="cb4-500" title="500"><span class="co">#&gt;     iqr = b_iqr(x, ...)</span></a>
<a class="sourceLine" id="cb4-501" title="501"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-502" title="502"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-503" title="503"><span class="co">#&gt; &lt;bytecode: 0x7ffd284d4bb0&gt;</span></a>
<a class="sourceLine" id="cb4-504" title="504"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-505" title="505"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-506" title="506"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb4-507" title="507"><span class="co">#&gt; function(x, ...){</span></a>
<a class="sourceLine" id="cb4-508" title="508"><span class="co">#&gt;   c(</span></a>
<a class="sourceLine" id="cb4-509" title="509"><span class="co">#&gt;     var = b_var(x, ...),</span></a>
<a class="sourceLine" id="cb4-510" title="510"><span class="co">#&gt;     sd = b_sd(x, ...),</span></a>
<a class="sourceLine" id="cb4-511" title="511"><span class="co">#&gt;     mad = b_mad(x, ...),</span></a>
<a class="sourceLine" id="cb4-512" title="512"><span class="co">#&gt;     iqr = b_iqr(x, ...)</span></a>
<a class="sourceLine" id="cb4-513" title="513"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-514" title="514"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-515" title="515"><span class="co">#&gt; &lt;bytecode: 0x7ffd284deb40&gt;</span></a>
<a class="sourceLine" id="cb4-516" title="516"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-517" title="517"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-518" title="518"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb4-519" title="519"><span class="co">#&gt; function(x, ...){</span></a>
<a class="sourceLine" id="cb4-520" title="520"><span class="co">#&gt;   c(</span></a>
<a class="sourceLine" id="cb4-521" title="521"><span class="co">#&gt;     min = b_min(x, ...),</span></a>
<a class="sourceLine" id="cb4-522" title="522"><span class="co">#&gt;     max = b_max(x, ...),</span></a>
<a class="sourceLine" id="cb4-523" title="523"><span class="co">#&gt;     median = b_median(x, ...),</span></a>
<a class="sourceLine" id="cb4-524" title="524"><span class="co">#&gt;     mean = b_mean(x, ...),</span></a>
<a class="sourceLine" id="cb4-525" title="525"><span class="co">#&gt;     q25 = b_q25(x, ...),</span></a>
<a class="sourceLine" id="cb4-526" title="526"><span class="co">#&gt;     q75 = b_q75(x, ...),</span></a>
<a class="sourceLine" id="cb4-527" title="527"><span class="co">#&gt;     range = b_range(x, ...),</span></a>
<a class="sourceLine" id="cb4-528" title="528"><span class="co">#&gt;     range_diff = b_range_diff(x, ...),</span></a>
<a class="sourceLine" id="cb4-529" title="529"><span class="co">#&gt;     sd = b_sd(x, ...),</span></a>
<a class="sourceLine" id="cb4-530" title="530"><span class="co">#&gt;     var = b_var(x, ...),</span></a>
<a class="sourceLine" id="cb4-531" title="531"><span class="co">#&gt;     mad = b_mad(x, ...),</span></a>
<a class="sourceLine" id="cb4-532" title="532"><span class="co">#&gt;     iqr = b_iqr(x, ...),</span></a>
<a class="sourceLine" id="cb4-533" title="533"><span class="co">#&gt;     increase = increasing(x, ...),</span></a>
<a class="sourceLine" id="cb4-534" title="534"><span class="co">#&gt;     decrease = decreasing(x, ...), </span></a>
<a class="sourceLine" id="cb4-535" title="535"><span class="co">#&gt;     unvary = unvarying(x, ...)</span></a>
<a class="sourceLine" id="cb4-536" title="536"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb4-537" title="537"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-538" title="538"><span class="co">#&gt; &lt;bytecode: 0x7ffd284fbed8&gt;</span></a>
<a class="sourceLine" id="cb4-539" title="539"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-540" title="540"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-541" title="541"><span class="co">#&gt; [[6]]</span></a>
<a class="sourceLine" id="cb4-542" title="542"><span class="co">#&gt; function(x, ...) {</span></a>
<a class="sourceLine" id="cb4-543" title="543"><span class="co">#&gt;   c(increase = increasing(x, ...),</span></a>
<a class="sourceLine" id="cb4-544" title="544"><span class="co">#&gt;     decrease = decreasing(x, ...), </span></a>
<a class="sourceLine" id="cb4-545" title="545"><span class="co">#&gt;     unvary = unvarying(x, ...),</span></a>
<a class="sourceLine" id="cb4-546" title="546"><span class="co">#&gt;     monotonic = monotonic(x, ...))</span></a>
<a class="sourceLine" id="cb4-547" title="547"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-548" title="548"><span class="co">#&gt; &lt;bytecode: 0x7ffd2850e490&gt;</span></a>
<a class="sourceLine" id="cb4-549" title="549"><span class="co">#&gt; &lt;environment: namespace:brolgar&gt;</span></a>
<a class="sourceLine" id="cb4-550" title="550"><span class="kw"><a href="https://fablelite.tidyverts.org/reference/feature_set.html">feature_set</a></span>(<span class="dt">tag =</span> <span class="st">"acf"</span>)</a>
<a class="sourceLine" id="cb4-551" title="551"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb4-552" title="552"><span class="co">#&gt; function (x, .period = 1, lag_max = NULL, ...) </span></a>
<a class="sourceLine" id="cb4-553" title="553"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb4-554" title="554"><span class="co">#&gt;     acfx &lt;- stats::acf(x, lag.max = lag_max %||% max(.period, </span></a>
<a class="sourceLine" id="cb4-555" title="555"><span class="co">#&gt;         10L), plot = FALSE, na.action = stats::na.pass, ...)</span></a>
<a class="sourceLine" id="cb4-556" title="556"><span class="co">#&gt;     acfdiff1x &lt;- stats::acf(diff(x, differences = 1), lag.max = lag_max %||% </span></a>
<a class="sourceLine" id="cb4-557" title="557"><span class="co">#&gt;         10L, plot = FALSE, na.action = stats::na.pass)</span></a>
<a class="sourceLine" id="cb4-558" title="558"><span class="co">#&gt;     acfdiff2x &lt;- stats::acf(diff(x, differences = 2), lag.max = lag_max %||% </span></a>
<a class="sourceLine" id="cb4-559" title="559"><span class="co">#&gt;         10L, plot = FALSE, na.action = stats::na.pass)</span></a>
<a class="sourceLine" id="cb4-560" title="560"><span class="co">#&gt;     acf_1 &lt;- acfx$acf[2L]</span></a>
<a class="sourceLine" id="cb4-561" title="561"><span class="co">#&gt;     sum_of_sq_acf10 &lt;- sum((acfx$acf[2L:11L])^2)</span></a>
<a class="sourceLine" id="cb4-562" title="562"><span class="co">#&gt;     diff1_acf1 &lt;- acfdiff1x$acf[2L]</span></a>
<a class="sourceLine" id="cb4-563" title="563"><span class="co">#&gt;     diff1_acf10 &lt;- sum((acfdiff1x$acf[-1L])^2)</span></a>
<a class="sourceLine" id="cb4-564" title="564"><span class="co">#&gt;     diff2_acf1 &lt;- acfdiff2x$acf[2L]</span></a>
<a class="sourceLine" id="cb4-565" title="565"><span class="co">#&gt;     diff2_acf10 &lt;- sum((acfdiff2x$acf[-1L])^2)</span></a>
<a class="sourceLine" id="cb4-566" title="566"><span class="co">#&gt;     output &lt;- c(acf1 = unname(acf_1), acf10 = unname(sum_of_sq_acf10), </span></a>
<a class="sourceLine" id="cb4-567" title="567"><span class="co">#&gt;         diff1_acf1 = unname(diff1_acf1), diff1_acf10 = unname(diff1_acf10), </span></a>
<a class="sourceLine" id="cb4-568" title="568"><span class="co">#&gt;         diff2_acf1 = unname(diff2_acf1), diff2_acf10 = unname(diff2_acf10))</span></a>
<a class="sourceLine" id="cb4-569" title="569"><span class="co">#&gt;     if (.period &gt; 1) {</span></a>
<a class="sourceLine" id="cb4-570" title="570"><span class="co">#&gt;         output &lt;- c(output, season_acf1 = unname(acfx$acf[.period + </span></a>
<a class="sourceLine" id="cb4-571" title="571"><span class="co">#&gt;             1L]))</span></a>
<a class="sourceLine" id="cb4-572" title="572"><span class="co">#&gt;     }</span></a>
<a class="sourceLine" id="cb4-573" title="573"><span class="co">#&gt;     return(output)</span></a>
<a class="sourceLine" id="cb4-574" title="574"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb4-575" title="575"><span class="co">#&gt; &lt;bytecode: 0x7ffd29106580&gt;</span></a>
<a class="sourceLine" id="cb4-576" title="576"><span class="co">#&gt; &lt;environment: namespace:feasts&gt;</span></a></code></pre></div>
</div>
<div id="registering-a-feature-in-a-package" class="section level2">
<h2 class="hasAnchor">
<a href="#registering-a-feature-in-a-package" class="anchor"></a>Registering a feature in a package</h2>
<p>Functions can be registered via <code><a href="https://fablelite.tidyverts.org/reference/register_feature.html">fablelite::register_feature()</a></code>. To register features in a package, I create a file called <code>zzz.R</code>, and use the <code><a href="https://www.rdocumentation.org/packages/base/topics/ns-hooks">.onLoad(...)</a></code> function to set this up on loading the package:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb5-2" title="2">  fablelite<span class="op">::</span><span class="kw"><a href="https://fablelite.tidyverts.org/reference/register_feature.html">register_feature</a></span>(feat_three_num, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"summary"</span>))</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="co"># ... and as many as you want here!</span></a>
<a class="sourceLine" id="cb5-4" title="4">}</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#accessing-sets-of-features">Accessing sets of features</a></li>
      <li><a href="#registering-a-feature-in-a-package">Registering a feature in a package</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney, Di Cook, Tania Prvan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '48bc42eefc5234a6463c3b99e53dfda1',
    indexName: 'brolgar',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
